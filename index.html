<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>@rp_gupta_07 | Elite Arena Pro</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, viewport-fit=cover">

<!-- CONFETTI -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
/* ========= SAME UI â€“ NO REMOVAL ========= */
:root{
 --primary:#00f2ff;
 --secondary:#7000ff;
 --bg:#050505;
 --card:rgba(255,255,255,.05);
 --win:#00ff88;
 --me:linear-gradient(135deg,#0084ff,#00c6ff);
 --other:#2a2a2a;
 --accent:#ff0055;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body,html{
 margin:0;height:100%;width:100%;
 background:var(--bg);color:#fff;
 font-family:system-ui;
 overflow:hidden;position:fixed;
}
.bg-glow{
 position:fixed;inset:0;
 background:radial-gradient(circle,#1a1a2e,#050505);
 z-index:-1;
}
.container{
 max-width:450px;height:100%;
 margin:auto;display:flex;flex-direction:column;
 backdrop-filter:blur(10px);
}
.hidden{display:none!important}

/* ========= NEW UX ADDITIONS ========= */
.toast{
 position:fixed;bottom:160px;left:50%;
 transform:translateX(-50%);
 background:#000;padding:8px 14px;
 border-radius:20px;font-size:11px;
 opacity:0;transition:.3s;
 z-index:99999;border:1px solid #333
}
.toast.show{opacity:1}

.last-move{box-shadow:0 0 15px var(--primary)}
.turn-indicator{
 font-size:10px;letter-spacing:1px;
 color:var(--win);font-weight:bold
}
</style>
</head>

<body>
<div class="bg-glow"></div>
<div id="toast" class="toast"></div>

<!-- ====== WINNER OVERLAY (UNCHANGED) ====== -->
<div id="winnerOverlay" style="display:none;position:fixed;inset:0;background:#000;z-index:9999;align-items:center;justify-content:center;flex-direction:column">
 <h1 id="winnerName" style="color:var(--win);font-size:42px">WIN</h1>
 <button onclick="restartMatch()" style="padding:14px 30px;border:none;border-radius:14px;background:var(--primary);font-weight:900">NEXT ROUND</button>
</div>

<!-- ====== APP CONTAINER ====== -->
<div class="container">

<!-- ===== LOGIN SCREEN (NO CHANGE) ===== -->
<div id="loginScreen" style="flex:1;display:flex;flex-direction:column;justify-content:center;padding:20px">
 <h1 style="text-align:center">ULTIMATE ARENA PRO</h1>
 <input id="userName" placeholder="ENTER PLAYER NAME">
 <button onclick="createRoom()">CREATE ARENA</button>
 <button onclick="startRobot()">SOLO VS ROBOT</button>
</div>

<!-- ===== GAME SCREEN ===== -->
<div id="gameScreen" class="hidden" style="flex:1;display:flex;flex-direction:column">

<div style="padding:10px;border-bottom:1px solid #222;display:flex;justify-content:space-between">
 <span id="status" class="turn-indicator">SYNCINGâ€¦</span>
 <button onclick="exitArena()">EXIT</button>
</div>

<div id="board" style="flex:1;display:grid;gap:8px;justify-content:center;align-content:center"></div>

<div style="padding:8px;display:flex;gap:10px;justify-content:center">
 <button onclick="undoMove()">UNDO</button>
 <button onclick="toggleSound()">ðŸ”Š</button>
</div>

</div>
</div>

<!-- ===== FIREBASE ===== -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* ========= FIREBASE CONFIG (UNCHANGED) ========= */
firebase.initializeApp({
 apiKey:"AIzaSyARuO_pN2vdYrVKYkKHHaNys7WI8HqM6I4",
 databaseURL:"https://friendchat-43941-default-rtdb.firebaseio.com"
});
const db=firebase.database();

/* ========= GAME STATE ========= */
let myName,myRoomId,mySymbol="X";
let gridSize=3,history=[],soundOn=true;
let gameRef,roundOver=false;

/* ========= UTIL ========= */
function toast(msg){
 let t=document.getElementById("toast");
 t.innerText=msg;t.classList.add("show");
 setTimeout(()=>t.classList.remove("show"),1500);
}

/* ========= CREATE ROOM ========= */
function createRoom(){
 myName=userName.value.trim()||"PLAYER";
 myRoomId=Math.floor(1000+Math.random()*9000);
 gameRef=db.ref("rooms/"+myRoomId);
 gameRef.set({
  board:Array(9).fill(""),
  turn:"X",
  players:{X:myName,O:"ROBOT"},
  scores:{X:0,O:0}
 });
 startGame();
}

/* ========= START ========= */
function startRobot(){
 createRoom();
}

/* ========= GAME INIT ========= */
function startGame(){
 loginScreen.classList.add("hidden");
 gameScreen.classList.remove("hidden");
 drawBoard();
 listenGame();
 toast("ARENA READY");
}

/* ========= BOARD ========= */
function drawBoard(){
 board.innerHTML="";
 board.style.gridTemplateColumns="repeat(3,90px)";
 for(let i=0;i<9;i++){
  let c=document.createElement("div");
  c.style.cssText="height:90px;background:#111;border-radius:14px;font-size:42px;display:flex;align-items:center;justify-content:center";
  c.onclick=()=>move(i);
  board.appendChild(c);
 }
}

/* ========= MOVE ========= */
function move(i){
 gameRef.once("value",s=>{
  let g=s.val();
  if(roundOver||g.turn!==mySymbol||g.board[i])return;
  history.push([...g.board]);
  g.board[i]=mySymbol;
  g.turn="O";
  gameRef.update(g);
 });
}

/* ========= LISTEN ========= */
function listenGame(){
 gameRef.on("value",s=>{
  let g=s.val();if(!g)return;
  g.board.forEach((v,i)=>{
   board.children[i].innerText=v;
  });
  let w=checkWinner(g.board);
  if(w){
   roundOver=true;
   winnerName.innerText=w==="draw"?"DRAW":g.players[w];
   winnerOverlay.style.display="flex";
   confetti();
  }else{
   status.innerText=g.turn===mySymbol?"YOUR TURN":"ROBOT THINKING";
   if(g.turn==="O")setTimeout(botMove,600);
  }
 });
}

/* ========= BOT ========= */
function botMove(){
 gameRef.once("value",s=>{
  let g=s.val();
  let empty=g.board.map((v,i)=>v?null:i).filter(v=>v!==null);
  let m=empty[Math.floor(Math.random()*empty.length)];
  g.board[m]="O";g.turn="X";
  gameRef.update(g);
 });
}

/* ========= WIN ========= */
function checkWinner(b){
 const l=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
 for(let x of l){
  if(b[x[0]]&&b[x[0]]===b[x[1]]&&b[x[1]]===b[x[2]])return b[x[0]];
 }
 return b.includes("")?null:"draw";
}

/* ========= EXTRA FEATURES ========= */
function undoMove(){
 if(!history.length)return toast("NO UNDO");
 gameRef.update({board:history.pop(),turn:mySymbol});
}
function toggleSound(){
 soundOn=!soundOn;
 toast(soundOn?"SOUND ON":"SOUND OFF");
}
function restartMatch(){
 roundOver=false;
 winnerOverlay.style.display="none";
 gameRef.update({board:Array(9).fill(""),turn:"X"});
}
function exitArena(){
 gameRef.off();location.reload();
}
</script>
</body>
    </html>            
<!-- ================= PART 2 : ADVANCED FEATURES ================= -->
<script>
/* ================= EXTRA GLOBAL STATE ================= */
let moveTimer=null;
let timeLeft=10;
let stats=JSON.parse(localStorage.getItem("arena_stats")||'{"win":0,"lose":0,"draw":0}');
let reconnectKey="arena_reconnect_"+myRoomId;

/* ================= TIMER FEATURE ================= */
function startTurnTimer(){
 clearInterval(moveTimer);
 timeLeft=10;
 status.innerText=`YOUR TURN (${timeLeft}s)`;
 moveTimer=setInterval(()=>{
  timeLeft--;
  status.innerText=`YOUR TURN (${timeLeft}s)`;
  if(timeLeft<=0){
   clearInterval(moveTimer);
   autoForfeit();
  }
 },1000);
}

function autoForfeit(){
 toast("TIME OUT!");
 roundOver=true;
 winnerName.innerText="ROBOT";
 winnerOverlay.style.display="flex";
 stats.lose++;saveStats();
}

/* ================= SMART AI (BLOCK + WIN) ================= */
function botMove(){
 gameRef.once("value",s=>{
  let g=s.val(); if(!g||roundOver)return;
  let b=[...g.board];

  // WIN
  let winIdx=findBestMove(b,"O");
  if(winIdx===-1) winIdx=findBestMove(b,"X");
  if(winIdx===-1){
   let empty=b.map((v,i)=>v===""?i:null).filter(v=>v!==null);
   winIdx=empty[Math.floor(Math.random()*empty.length)];
  }

  b[winIdx]="O";
  gameRef.update({board:b,turn:"X"});
 });
}

function findBestMove(b,sym){
 const lines=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
 for(let l of lines){
  let vals=l.map(i=>b[i]);
  if(vals.filter(v=>v===sym).length===2 && vals.includes("")){
   return l[vals.indexOf("")];
  }
 }
 return -1;
}

/* ================= LAST MOVE HIGHLIGHT ================= */
function highlightLastMove(idx){
 [...board.children].forEach(c=>c.classList.remove("last-move"));
 if(board.children[idx]) board.children[idx].classList.add("last-move");
}

/* ================= LISTEN PATCH ================= */
const oldListenGame=listenGame;
listenGame=function(){
 gameRef.on("value",s=>{
  let g=s.val(); if(!g)return;
  g.board.forEach((v,i)=>{
   board.children[i].innerText=v;
  });

  let w=checkWinner(g.board);
  if(w){
   roundOver=true;
   if(w==="draw"){ stats.draw++; }
   else if(w===mySymbol){ stats.win++; }
   else { stats.lose++; }
   saveStats();
   winnerName.innerText=w==="draw"?"DRAW":g.players[w];
   winnerOverlay.style.display="flex";
   confetti();
   clearInterval(moveTimer);
  }else{
   if(g.turn===mySymbol){
    startTurnTimer();
   }else{
    clearInterval(moveTimer);
    status.innerText="ROBOT THINKINGâ€¦";
    setTimeout(botMove,700);
   }
  }
 });
}

/* ================= UNDO LIMIT ================= */
let undoUsed=false;
function undoMove(){
 if(undoUsed) return toast("UNDO USED");
 if(!history.length) return toast("NO MOVE");
 undoUsed=true;
 gameRef.update({board:history.pop(),turn:mySymbol});
 toast("UNDO SUCCESS");
}

/* ================= STATS ================= */
function saveStats(){
 localStorage.setItem("arena_stats",JSON.stringify(stats));
}

/* ================= RECONNECT SUPPORT ================= */
window.addEventListener("beforeunload",()=>{
 if(myRoomId){
  localStorage.setItem(reconnectKey,JSON.stringify({room:myRoomId,name:myName}));
 }
});

(function autoReconnect(){
 let d=localStorage.getItem(reconnectKey);
 if(d){
  d=JSON.parse(d);
  myName=d.name;
  myRoomId=d.room;
  gameRef=db.ref("rooms/"+myRoomId);
  startGame();
  toast("RECONNECTED");
 }
})();

/* ================= SOUND EFFECTS ================= */
const sndMove=new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");
const sndWin=new Audio("https://actions.google.com/sounds/v1/cartoon/concussive_drum_hit.ogg");

function playMove(){
 if(soundOn) sndMove.play();
}
function playWin(){
 if(soundOn) sndWin.play();
}

/* ================= PATCH MOVE ================= */
const oldMove=move;
move=function(i){
 gameRef.once("value",s=>{
  let g=s.val();
  if(roundOver||g.turn!==mySymbol||g.board[i])return;
  history.push([...g.board]);
  g.board[i]=mySymbol;
  highlightLastMove(i);
  playMove();
  gameRef.update({board:g.board,turn:"O"});
 });
}

/* ================= EMOJI CELEBRATION ================= */
function emojiRain(e){
 for(let i=0;i<15;i++){
  let el=document.createElement("div");
  el.innerText=e;
  el.style.position="fixed";
  el.style.left=Math.random()*100+"%";
  el.style.top="-50px";
  el.style.fontSize="30px";
  el.style.zIndex=99999;
  document.body.appendChild(el);
  el.animate([{transform:"translateY(0)"},{transform:"translateY(600px)"}],1500);
  setTimeout(()=>el.remove(),1500);
 }
}

/* ================= FULLSCREEN ================= */
function toggleFull(){
 if(!document.fullscreenElement) document.documentElement.requestFullscreen();
 else document.exitFullscreen();
}

/* ================= THEME SWITCH ================= */
function neonTheme(){
 document.documentElement.style.setProperty("--primary","#00ffcc");
 document.documentElement.style.setProperty("--accent","#ffcc00");
 toast("NEON MODE");
}

/* ================= SECURITY (BASIC) ================= */
document.addEventListener("contextmenu",e=>e.preventDefault());

/* ================= READY ================= */
console.log("Elite Arena Pro â€“ PART 2 Loaded");
</script>
