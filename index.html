<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RP Gupta Real Ludo Pro</title>
    <style>
        :root { --red: #ff4757; --green: #2ed573; --blue: #1e90ff; --yellow: #ffa502; --bg: #1e1e2e; }
        body { background: var(--bg); color: white; font-family: sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; }
        
        #status-bar { background: #2d2d44; width: 100%; padding: 15px; text-align: center; font-weight: bold; border-bottom: 3px solid #3d3d5c; }

        /* Ludo Board with Real Grid Lines */
        .ludo-board { 
            position: relative; width: 95vw; height: 95vw; max-width: 420px; max-height: 420px; 
            margin: 20px auto; background: #fff; display: grid; 
            grid-template-columns: repeat(15, 1fr); grid-template-rows: repeat(15, 1fr);
            border: 4px solid #333; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        /* Drawing Boxes/Lines */
        .cell { border: 0.5px solid #ccc; box-sizing: border-box; position: relative; }
        
        /* Home Squares */
        .home { border: 2px solid #333; }
        .red-home { grid-area: 1/1/7/7; background: var(--red); }
        .green-home { grid-area: 1/10/7/16; background: var(--green); }
        .blue-home { grid-area: 10/1/16/7; background: var(--blue); }
        .yellow-home { grid-area: 10/10/16/16; background: var(--yellow); }
        .center-finish { grid-area: 7/7/10/10; background: #eee; border: 2px solid #333; display: flex; align-items: center; justify-content: center; color: #333; font-weight: bold; font-size: 10px; }

        /* Path Coloring (Lines where tokens move) */
        .path-red { background: #ffcccc; }
        .path-green { background: #ccffcc; }
        .path-yellow { background: #fff4cc; }
        .path-blue { background: #cce5ff; }
        .safe { background: #bdc3c7 !important; } /* Star/Safe spot */

        /* Professional Tokens (Goti) */
        .token { 
            width: 70%; height: 70%; border-radius: 50%; position: absolute; 
            top: 15%; left: 15%; border: 2px solid #fff; 
            box-shadow: 0 3px 6px rgba(0,0,0,0.4); z-index: 100;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* Controls */
        .controls { width: 100%; display: flex; justify-content: space-around; align-items: center; padding: 20px 0; background: #2d2d44; position: fixed; bottom: 0; }
        .dice-box { width: 60px; height: 60px; background: white; border-radius: 12px; color: #333; display: flex; align-items: center; justify-content: center; font-size: 30px; font-weight: bold; box-shadow: 0 5px 0 #999; }
        button { padding: 15px 30px; border-radius: 50px; border: none; background: #2ed573; color: white; font-weight: bold; font-size: 18px; cursor: pointer; box-shadow: 0 4px 0 #1a7e43; }
        button:active { transform: translateY(4px); box-shadow: none; }
    </style>
</head>
<body>

<div id="status-bar">Ludo Online: Baari ka intezar...</div>

<div class="ludo-board" id="board">
    </div>

<div class="controls">
    <div id="my-label">Aap: ?</div>
    <div class="dice-box" id="dice-ui">?</div>
    <button id="roll-btn" onclick="handleRoll()">Dice Roll</button>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
    import { getDatabase, ref, set, onValue, update } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyARuO_pN2vdYrVKYkKHHaNys7WI8HqM6I4",
        authDomain: "friendchat-43941.firebaseapp.com",
        databaseURL: "https://friendchat-43941-default-rtdb.firebaseio.com",
        projectId: "friendchat-43941",
        storageBucket: "friendchat-43941.appspot.com",
        messagingSenderId: "1026542245723",
        appId: "1:1026542245723:web:b892bfcc1d2358a018ac7e"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const gameRef = ref(db, 'ludo/room_final_1');

    // 1. Create Board Layout
    const board = document.getElementById('board');
    for(let i=0; i<225; i++) {
        let cell = document.createElement('div');
        cell.className = 'cell';
        board.appendChild(cell);
    }

    // Static Sections
    board.children[0].className = 'home red-home';
    board.children[9].className = 'home green-home';
    board.children[135].className = 'home blue-home';
    board.children[144].className = 'home yellow-home';
    board.children[96].className = 'center-finish';
    board.children[96].innerText = "FINISH";

    // 2. Setup Tokens
    let redGoti = document.createElement('div');
    redGoti.className = 'token';
    redGoti.style.background = 'var(--red)';
    board.children[16].appendChild(redGoti);

    let yellowGoti = document.createElement('div');
    yellowGoti.className = 'token';
    yellowGoti.style.background = 'var(--yellow)';
    board.children[158].appendChild(yellowGoti);

    // 3. Multiplayer Logic
    let myColor = "";
    let gameState = { turn: 'red', dice: 0, p1Pos: 0, p2Pos: 0 };

    window.handleRoll = () => {
        if(gameState.turn !== myColor) return alert("Aapki baari nahi hai!");
        const roll = Math.floor(Math.random() * 6) + 1;
        update(gameRef, { dice: roll, turn: myColor === 'red' ? 'yellow' : 'red' });
    };

    onValue(gameRef, (snap) => {
        const data = snap.val();
        if(!data) return set(gameRef, gameState);
        gameState = data;
        document.getElementById('dice-ui').innerText = data.dice;
        document.getElementById('status-bar').innerText = data.turn === myColor ? "AAPKI BAARI!" : "DOST CHAL RAHA HAI...";
    });

    window.onload = () => {
        myColor = confirm("Red loge? (OK=Red, Cancel=Yellow)") ? 'red' : 'yellow';
        document.getElementById('my-label').innerText = "Aap: " + myColor.toUpperCase();
    };
</script>

</body>
</html>
