<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>Elite Arena Master - @rp_gupta_07</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
<style>
:root { --primary: #00f2ff; --win: #00ff88; --bg: #000; --accent: #ff4d4d; --gold: #ffd700; }
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body { margin: 0; background: var(--bg); color: #fff; font-family: 'Segoe UI', sans-serif; overflow: hidden; }

/* Animations like before */
@keyframes neonPulse { 0% { box-shadow: 0 0 5px var(--primary); } 50% { box-shadow: 0 0 20px var(--primary); } 100% { box-shadow: 0 0 5px var(--primary); } }
@keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

.container { max-width: 450px; margin: auto; height: 100vh; display: flex; flex-direction: column; position: relative; }
.screen { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
.hidden { display: none !important; }

/* Board & Cells */
#board { display: grid; gap: 8px; margin-top: 20px; }
.cell { background: rgba(255,255,255,0.05); border: 1px solid rgba(0,242,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; font-weight: 900; cursor: pointer; transition: 0.3s; }
.cell:active { transform: scale(0.9); background: rgba(0,242,255,0.1); }
.win-anim { animation: neonPulse 1s infinite; background: var(--win) !important; color: #000 !important; }

/* Admin Chat / Broadcast */
#adminMsgBox { position: fixed; top: 10px; width: 90%; left: 5%; background: rgba(0,242,255,0.9); color: #000; padding: 10px; border-radius: 8px; font-weight: bold; text-align: center; z-index: 10002; display: none; animation: slideUp 0.5s reverse; }

/* UI Elements */
.btn-main { width: 100%; padding: 15px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; margin-top: 10px; }
.btn-cyan { background: var(--primary); color: #000; }
.coin-badge { position: absolute; top: 20px; left: 20px; color: var(--gold); font-weight: 900; background: rgba(255,215,0,0.1); padding: 5px 15px; border-radius: 20px; border: 1px solid var(--gold); }

#adminPanel { position: fixed; bottom: -100%; left: 0; width: 100%; background: #111; border-top: 3px solid var(--primary); padding: 20px; z-index: 10005; transition: 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
</style>
</head>
<body>

<div id="adminMsgBox">ADMIN: <span id="msgContent"></span></div>
<div class="coin-badge">ðŸ’Ž <span id="myCoins">0</span></div>

<div class="container">
    <div id="loginScreen" class="screen">
        <h1 style="color:var(--primary); font-size: 3rem; margin-bottom: 0;">ELITE ARENA</h1>
        <p style="margin-top:0; opacity: 0.6;">PRO MAX EDITION</p>
        
        <input id="userName" placeholder="ENTER NAME" style="width:100%; padding:15px; border-radius:10px; border:none; background:#222; color:#fff; margin-bottom:10px;">
        <button id="createBtn" class="btn-main btn-cyan">CREATE ARENA</button>
        <button id="robotBtn" class="btn-main" style="background:#fff;">VS AI ROBOT</button>
        <button id="joinBtn" class="btn-main" style="background:#222; color:#fff; border: 1px solid #444;">JOIN WITH CODE</button>
        <input id="joinCode" placeholder="PASTE CODE HERE" style="width:100%; padding:10px; margin-top:5px; border-radius:8px; background:#111; color:#fff; border:1px solid #333;">
    </div>

    <div id="gameScreen" class="screen hidden">
        <div id="status" style="margin-bottom:10px; font-size:12px; color:var(--primary);">YOUR TURN</div>
        <div id="board"></div>
        <div style="margin-top:30px; display:flex; gap:10px;">
            <button onclick="sendEmoji('ðŸ˜‚')" style="background:#222; border:none; padding:10px; border-radius:50%; font-size:20px;">ðŸ˜‚</button>
            <button onclick="sendEmoji('ðŸ”¥')" style="background:#222; border:none; padding:10px; border-radius:50%; font-size:20px;">ðŸ”¥</button>
            <button onclick="sendEmoji('ðŸ¤¡')" style="background:#222; border:none; padding:10px; border-radius:50%; font-size:20px;">ðŸ¤¡</button>
            <button onclick="toggleAdmin()" style="opacity:0.01">.</button>
        </div>
    </div>
</div>

<div id="adminPanel">
    <h3 style="color:var(--primary); margin-top:0;">ADMIN CONTROL</h3>
    <input id="adminBroadcast" placeholder="MESSAGE ALL PLAYERS..." style="width:100%; padding:10px; background:#222; border:none; color:#fff; border-radius:5px;">
    <button onclick="broadcastMsg()" class="btn-main btn-cyan">SEND AS ADMIN</button>
    <button onclick="addBonus()" class="btn-main" style="background:var(--gold);">GIVE 1000 DIAMONDS</button>
    <button onclick="toggleAdmin()" class="btn-main" style="background:#444; color:#fff;">CLOSE</button>
</div>

<audio id="sfx-click" src="https://actions.google.com/sounds/v1/foley/button_click.ogg"></audio>
<audio id="sfx-win" src="https://actions.google.com/sounds/v1/cartoon/conga_hit_alt.ogg"></audio>
<audio id="sfx-draw" src="https://actions.google.com/sounds/v1/cartoon/boing.ogg"></audio>
<audio id="sfx-coin" src="https://actions.google.com/sounds/v1/foley/money_clink.ogg"></audio>
<audio id="sfx-msg" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>
<audio id="sfx-admin" src="https://actions.google.com/sounds/v1/alarms/mechanical_clock_ringing.ogg"></audio>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// Firebase Setup
const firebaseConfig = { apiKey: "AIzaSyARuO_pN2vdYrVKYkKHHaNys7WI8HqM6I4", databaseURL: "https://friendchat-43941-default-rtdb.firebaseio.com" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let myName, mySymbol, myRoomId, gameRef, coins = localStorage.getItem('coins') || 0;
document.getElementById('myCoins').innerText = coins;

// Audio Player
function play(id) { 
    const a = document.getElementById('sfx-'+id);
    if(a) { a.currentTime = 0; a.play(); }
}

// Admin Messaging
function broadcastMsg() {
    const m = document.getElementById('adminBroadcast').value;
    if(m) {
        db.ref('global_msg').set({ text: m, time: Date.now() });
        document.getElementById('adminBroadcast').value = "";
    }
}

db.ref('global_msg').on('value', snap => {
    const data = snap.val();
    if(data) {
        play('admin');
        const box = document.getElementById('adminMsgBox');
        document.getElementById('msgContent').innerText = data.text;
        box.style.display = "block";
        setTimeout(() => box.style.display = "none", 5000);
    }
});

// Game Logic
document.getElementById('createBtn').onclick = () => {
    myRoomId = Math.floor(1000 + Math.random()*9000);
    myName = document.getElementById('userName').value || "Elite";
    mySymbol = "X";
    setupGame();
    alert("Share this code: " + myRoomId);
};

document.getElementById('joinBtn').onclick = () => {
    myRoomId = document.getElementById('joinCode').value;
    myName = document.getElementById('userName').value || "Guest";
    mySymbol = "O";
    setupGame();
};

function setupGame() {
    gameRef = db.ref('rooms/' + myRoomId);
    if(mySymbol === "X") {
        gameRef.set({ board: Array(9).fill(""), turn: "X", winner: null });
    }
    
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('gameScreen').classList.remove('hidden');
    initBoard();
}

function initBoard() {
    const bEl = document.getElementById('board');
    bEl.style.gridTemplateColumns = "repeat(3, 100px)";
    
    gameRef.on('value', snap => {
        const data = snap.val();
        bEl.innerHTML = "";
        data.board.forEach((val, i) => {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.style.width = "100px"; cell.style.height = "100px";
            cell.innerText = val;
            if(val === "X") cell.style.color = "var(--primary)";
            if(val === "O") cell.style.color = "var(--accent)";
            
            cell.onclick = () => {
                if(data.turn === mySymbol && !val && !data.winner) {
                    play('click');
                    data.board[i] = mySymbol;
                    checkWin(data.board);
                }
            };
            bEl.appendChild(cell);
        });
        
        if(data.winner) {
            if(data.winner === mySymbol) {
                play('win'); confetti();
                addCoins(10);
            } else if(data.winner === "draw") {
                play('draw');
            }
        }
    });
}

function checkWin(b) {
    const wins = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
    let winner = null;
    wins.forEach(w => {
        if(b[w[0]] && b[w[0]] === b[w[1]] && b[w[0]] === b[w[2]]) winner = b[w[0]];
    });
    if(!winner && !b.includes("")) winner = "draw";
    gameRef.update({ board: b, turn: mySymbol === "X" ? "O" : "X", winner: winner });
}

function addCoins(amt) {
    coins = parseInt(coins) + amt;
    localStorage.setItem('coins', coins);
    document.getElementById('myCoins').innerText = coins;
    play('coin');
}

function toggleAdmin() {
    const p = document.getElementById('adminPanel');
    p.style.bottom = p.style.bottom === "0px" ? "-100%" : "0px";
}

function addBonus() { addCoins(1000); play('win'); }
function sendEmoji(e) { play('msg'); }
</script>
</body>
</html>

