<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiplayer Guessing Game</title>
    <style>
        body { font-family: sans-serif; background: #0b0e11; color: #fff; text-align: center; margin: 0; padding: 20px; }
        .card { background: #1c2128; padding: 20px; border-radius: 15px; max-width: 400px; margin: auto; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        h2 { color: #1d9bf0; }
        input { width: 80%; padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid #333; background: #0d1117; color: #fff; text-align: center; }
        button { width: 85%; padding: 12px; background: #1d9bf0; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        button:hover { background: #1a8cd8; }
        #gameArea { display: none; }
        .log { margin-top: 20px; height: 150px; overflow-y: auto; background: #0d1117; padding: 10px; border-radius: 8px; font-size: 14px; text-align: left; }
        .status { margin: 15px 0; font-weight: bold; color: #ffad1f; }
        #credit { font-size: 12px; color: #555; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="card" id="loginBox">
        <h2>ðŸŽ® Multiplayer Guess</h2>
        <div id="credit">Game by @rp_gupta_07</div>
        <input type="text" id="username" placeholder="Apna Naam Likho">
        <input type="text" id="roomcode" placeholder="Room Code (e.g. 777)">
        <button onclick="startApp()">Game Join Karein</button>
    </div>

    <div class="card" id="gameArea">
        <h3 id="roomDisplay"></h3>
        <p>1 se 100 ke beech ka number guess karo!</p>
        <div class="status" id="hint">Waiting for moves...</div>
        <input type="number" id="guessInput" placeholder="Number daalein">
        <button onclick="sendGuess()">Guess!</button>
        
        <div class="log" id="gameLog"></div>
        <button onclick="location.reload()" style="background:#e53935; margin-top:10px;">Leave Game</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
        import { getDatabase, ref, set, onValue, push, remove } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

        // Aapke purane chat app ki Firebase details
        const firebaseConfig = {
            apiKey: "AIzaSyARuO_pN2vdYrVKYkKHHaNys7WI8HqM6I4",
            authDomain: "friendchat-43941.firebaseapp.com",
            databaseURL: "https://friendchat-43941-default-rtdb.firebaseio.com",
            projectId: "friendchat-43941",
            storageBucket: "friendchat-43941.firebasestorage.app",
            messagingSenderId: "1026542245723",
            appId: "1:1026542245723:web:b892bfcc1d2358a018ac7e"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        let user, room, targetNumber;

        window.startApp = () => {
            user = document.getElementById('username').value.trim();
            room = document.getElementById('roomcode').value.trim();
            if(!user || !room) return alert("Naam aur Room Code zaroori hai!");

            document.getElementById('loginBox').style.display = 'none';
            document.getElementById('gameArea').style.display = 'block';
            document.getElementById('roomDisplay').innerText = "Room: " + room;

            // Setup Game: Agar room naya hai toh secret number generate karo
            const gameRef = ref(db, `games/${room}/config`);
            onValue(gameRef, (snapshot) => {
                if (!snapshot.exists()) {
                    set(gameRef, { target: Math.floor(Math.random() * 100) + 1 });
                } else {
                    targetNumber = snapshot.val().target;
                }
            }, { onlyOnce: false });

            listenForGuesses();
        };

        window.sendGuess = () => {
            const val = parseInt(document.getElementById('guessInput').value);
            if(!val) return;

            let hint = "";
            if(val < targetNumber) hint = "Low! â¬†ï¸";
            else if(val > targetNumber) hint = "High! â¬‡ï¸";
            else hint = "WON! ðŸŽ‰";

            push(ref(db, `games/${room}/moves`), { user, val, hint });
            document.getElementById('guessInput').value = "";
        };

        function listenForGuesses() {
            onValue(ref(db, `games/${room}/moves`), (snapshot) => {
                const log = document.getElementById('gameLog');
                const hintDiv = document.getElementById('hint');
                log.innerHTML = "";
                
                if (snapshot.exists()) {
                    const data = snapshot.val();
                    Object.values(data).reverse().forEach(move => {
                        const p = document.createElement('p');
                        p.innerHTML = `<b>${move.user}:</b> ${move.val} (${move.hint})`;
                        log.appendChild(p);

                        if(move.hint === "WON! ðŸŽ‰") {
                            hintDiv.innerHTML = `<span style="color:#4BB543">${move.user} Jeet Gaya! No: ${move.val}</span>`;
                        }
                    });
                }
            });
        }
    </script>
</body>
</html>
