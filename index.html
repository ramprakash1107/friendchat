<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>Elite Arena</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
:root{--p:#00d2ff;--bg:#000;--cell:#111;--win:#00ff88;}
body{margin:0;background:#000;color:#fff;font-family:sans-serif}
#board{display:grid;gap:6px;margin:15px auto}
.cell{width:90px;height:90px;background:#111;border-radius:8px;
display:flex;align-items:center;justify-content:center;
font-size:40px;border:1px solid #333;cursor:pointer}
.win{box-shadow:0 0 15px var(--win)}
button,input{padding:10px;border-radius:8px;border:none}
</style>
</head>

<body>

<div id="login">
  <input id="name" placeholder="Naam"><br><br>
  <button onclick="create()">CREATE</button>
  <br><br>
  <input id="code" placeholder="Room Code">
  <button onclick="join()">JOIN</button>
</div>

<div id="game" style="display:none;text-align:center">
  <div>
    CODE: <b id="room"></b>
    <button onclick="copy()">COPY</button>
  </div>
  <div id="status">WAIT</div>
  <div id="board"></div>
</div>

<audio id="moveS" src="https://assets.mixkit.co/sfx/preview/mixkit-click-1110.mp3"></audio>
<audio id="winS" src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3"></audio>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
firebase.initializeApp({
 apiKey:"AIzaSyARuO_pN2vdYrVKYkKHHaNys7WI8HqM6I4",
 databaseURL:"https://friendchat-43941-default-rtdb.firebaseio.com"
});
const db=firebase.database();

let room,my="X",name,grid=3,timer;

function create(){
 name=nameInput();
 room=rand();
 init("X");
}
function join(){
 name=nameInput();
 room=document.getElementById("code").value;
 init("O");
}
function nameInput(){
 const n=document.getElementById("name").value;
 if(!n) alert("Naam likho");
 return n;
}
function rand(){return Math.floor(10000+Math.random()*90000)}

function init(sym){
 my=sym;
 document.getElementById("login").style.display="none";
 document.getElementById("game").style.display="block";
 document.getElementById("room").innerText=room;

 const ref=db.ref("rooms/"+room);

 if(sym==="X"){
  ref.set({
   size:grid,
   board:Array(grid*grid).fill(""),
   turn:"X",
   players:{X:{n:name,ready:true}}
  });
 }else{
  ref.child("players/O").set({n:name,ready:true});
 }

 ref.on("value",s=>{
  const g=s.val(); if(!g) return;
  draw(g);
  if(g.turn===my) startTimer(ref);
 });
 ref.onDisconnect().remove();
}

function draw(g){
 const b=document.getElementById("board");
 b.innerHTML="";
 b.style.gridTemplateColumns=`repeat(${g.size},90px)`;
 g.board.forEach((v,i)=>{
  const c=document.createElement("div");
  c.className="cell";
  c.innerText=v;
  c.onclick=()=>move(i,g);
  b.appendChild(c);
 });
 const w=winner(g.board,g.size);
 if(w){
  document.getElementById("status").innerText="WINNER";
  document.getElementById("winS").play();
  w.forEach(i=>b.children[i].classList.add("win"));
  confetti();
 }else{
  document.getElementById("status").innerText=
   g.turn===my?"YOUR TURN":"WAIT";
 }
}

function move(i,g){
 if(g.turn!==my||g.board[i]||winner(g.board,g.size))return;
 g.board[i]=my;
 db.ref("rooms/"+room).update({
  board:g.board,
  turn:my==="X"?"O":"X"
 });
 document.getElementById("moveS").play();
}

function startTimer(ref){
 clearTimeout(timer);
 timer=setTimeout(()=>{
  ref.child("turn").set(my==="X"?"O":"X");
 },10000);
}

function copy(){
 navigator.clipboard.writeText(room);
 alert("Copied");
}

function winner(b,s){
 const need=s===3?3:s===5?4:5;
 const lines=[];
 for(let i=0;i<s;i++)
  for(let j=0;j<=s-need;j++){
   lines.push([...Array(need)].map((_,k)=>i*s+j+k));
   lines.push([...Array(need)].map((_,k)=>(j+k)*s+i));
  }
 for(let r=0;r<=s-need;r++)
  for(let c=0;c<=s-need;c++)
   lines.push([...Array(need)].map((_,k)=>(r+k)*s+c+k));
 for(let l of lines)
  if(b[l[0]]&&l.every(i=>b[i]===b[l[0]]))return l;
 return null;
}
</script>
</body>
</html>
