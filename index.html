<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Real Ludo Online</title>

<style>
body{
  margin:0;
  background:#111;
  color:#fff;
  font-family:system-ui;
  text-align:center;
}
#board{
  width:360px;
  height:360px;
  margin:10px auto;
  display:grid;
  grid-template-columns:repeat(15,1fr);
  grid-template-rows:repeat(15,1fr);
  background:#fff;
  border:3px solid #000;
}
.cell{
  border:1px solid #ccc;
  position:relative;
}
.red{background:#e53935}
.green{background:#43a047}
.safe{background:#ddd}

.goti{
  width:18px;
  height:18px;
  border-radius:50%;
  position:absolute;
  top:50%;left:50%;
  transform:translate(-50%,-50%);
}

button{
  padding:10px 16px;
  border:none;
  border-radius:8px;
  background:#1d9bf0;
  color:#fff;
  font-size:16px;
}
#dice{font-size:26px;margin:6px}
</style>
</head>

<body>

<h3 id="roomText"></h3>
<h4 id="turnText"></h4>

<div id="board"></div>

<div id="dice">ðŸŽ² -</div>
<button onclick="rollDice()">ROLL</button>

<script type="module">
/* ---------- FIREBASE ---------- */
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getDatabase, ref, set, get, update, onValue }
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyARuO_pN2vdYrVKYkKHHaNys7WI8HqM6I4",
  databaseURL: "https://friendchat-43941-default-rtdb.firebaseio.com",
  projectId: "friendchat-43941",
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ---------- ROOM ---------- */
const room = prompt("Room code");
const myColor = prompt("Color (red / green)");
document.getElementById("roomText").textContent="Room: "+room;

const gameRef = ref(db,"ludo/"+room);

/* ---------- REAL PATH (VISIBLE) ---------- */
const path = [
  1,2,3,4,5,
  20,35,50,65,80,
  81,82,83,84,85,
  70,55,40,25,
  24,23,22,21
];

/* ---------- INIT ONCE ---------- */
get(gameRef).then(s=>{
  if(!s.exists()){
    set(gameRef,{
      turn:"red",
      dice:0,
      red:{pos:-1},
      green:{pos:-1}
    });
  }
});

/* ---------- BOARD ---------- */
const board=document.getElementById("board");
for(let i=0;i<225;i++){
  const d=document.createElement("div");
  d.className="cell";
  d.id="c"+i;
  board.appendChild(d);
}

/* COLOR PATH CELLS */
path.forEach(i=>{
  document.getElementById("c"+i).classList.add("safe");
});

/* ---------- DRAW ---------- */
function draw(s){
  document.querySelectorAll(".cell").forEach(c=>c.innerHTML="");
  ["red","green"].forEach(col=>{
    const p=s[col].pos;
    if(p>=0){
      const g=document.createElement("div");
      g.className="goti "+col;
      document.getElementById("c"+path[p]).appendChild(g);
    }
  });
  document.getElementById("dice").textContent="ðŸŽ² "+s.dice;
  document.getElementById("turnText").textContent="Turn: "+s.turn;
}

/* ---------- LISTENER ---------- */
onValue(gameRef,s=>{
  if(s.exists()) draw(s.val());
});

/* ---------- GAME LOGIC ---------- */
window.rollDice = ()=>{
  get(gameRef).then(snap=>{
    const s=snap.val();
    if(s.turn!==myColor){
      alert("Aapki turn nahi hai");
      return;
    }

    const d=Math.floor(Math.random()*6)+1;
    let me=s[myColor];
    const other=myColor==="red"?"green":"red";

    if(me.pos===-1){
      if(d===6) me.pos=0;
    }else if(me.pos+d < path.length){
      me.pos+=d;
    }

    // CUT
    if(me.pos>=0 && me.pos===s[other].pos){
      s[other].pos=-1;
    }

    update(gameRef,{
      dice:d,
      [myColor]:me,
      [other]:s[other],
      turn:other
    });
  });
};
</script>

</body>
</html>
