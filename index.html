<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RP Gupta Ludo King Online</title>
    <style>
        :root { --red: #ff4757; --green: #2ed573; --blue: #1e90ff; --yellow: #ffa502; --bg: #1e1e2e; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; overflow: hidden; }
        
        #status-bar { background: #2d2d44; width: 100%; padding: 15px; text-align: center; font-weight: bold; border-bottom: 3px solid #3d3d5c; font-size: 16px; color: #2ed573; }

        /* Real Ludo Board with Grid Lines */
        .ludo-board { 
            position: relative; width: 95vw; height: 95vw; max-width: 420px; max-height: 420px; 
            margin: 20px auto; background: #fff; display: grid; 
            grid-template-columns: repeat(15, 1fr); grid-template-rows: repeat(15, 1fr);
            border: 5px solid #333; box-shadow: 0 10px 40px rgba(0,0,0,0.6);
        }

        .cell { border: 0.5px solid #bbb; box-sizing: border-box; position: relative; }
        
        /* Home Design */
        .home { border: 2px solid #333; z-index: 5; }
        .red-home { grid-area: 1/1/7/7; background: var(--red); }
        .green-home { grid-area: 1/10/7/16; background: var(--green); }
        .blue-home { grid-area: 10/1/16/7; background: var(--blue); }
        .yellow-home { grid-area: 10/10/16/16; background: var(--yellow); }
        
        .center-finish { 
            grid-area: 7/7/10/10; background: #fff; border: 2px solid #333; 
            display: flex; align-items: center; justify-content: center; 
            font-weight: bold; color: #333; font-size: 12px; z-index: 6;
        }

        /* Safe Spots and Paths */
        .safe-star { background: #d1d1d1 !important; display: flex; align-items: center; justify-content: center; font-size: 10px; }
        .red-path { background: #ffcccc; }
        .yellow-path { background: #fff4cc; }

        /* Tokens (Goti) */
        .token { 
            width: 80%; height: 80%; border-radius: 50%; position: absolute; 
            top: 10%; left: 10%; border: 2px solid #fff; 
            box-shadow: 0 3px 6px rgba(0,0,0,0.4); z-index: 100;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* Controls */
        .controls { width: 100%; display: flex; justify-content: space-around; align-items: center; padding: 20px 0; background: #2d2d44; position: fixed; bottom: 0; border-top: 2px solid #3d3d5c; }
        .dice-ui { width: 60px; height: 60px; background: white; border-radius: 12px; color: #333; display: flex; align-items: center; justify-content: center; font-size: 32px; font-weight: bold; box-shadow: 0 6px 0 #999; }
        button { padding: 15px 35px; border-radius: 50px; border: none; background: #2ed573; color: white; font-weight: bold; font-size: 18px; cursor: pointer; box-shadow: 0 4px 0 #1a7e43; }
        button:disabled { background: #555; box-shadow: none; opacity: 0.6; }
    </style>
</head>
<body>

<div id="status-bar">Connecting to Firebase...</div>

<div class="ludo-board" id="ludo-board">
    <div class="home red-home"></div>
    <div class="home green-home"></div>
    <div class="home blue-home"></div>
    <div class="home yellow-home"></div>
    <div class="center-finish">FINISH</div>
</div>

<div class="controls">
    <div id="player-tag" style="font-weight:bold;">Aap: ?</div>
    <div class="dice-ui" id="dice-val">?</div>
    <button id="roll-btn" onclick="handleRoll()">ROLL</button>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
    import { getDatabase, ref, set, onValue, update } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyARuO_pN2vdYrVKYkKHHaNys7WI8HqM6I4",
        authDomain: "friendchat-43941.firebaseapp.com",
        databaseURL: "https://friendchat-43941-default-rtdb.firebaseio.com",
        projectId: "friendchat-43941",
        storageBucket: "friendchat-43941.appspot.com",
        messagingSenderId: "1026542245723",
        appId: "1:1026542245723:web:b892bfcc1d2358a018ac7e"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const gameRef = ref(db, 'ludo/multiplayer_pro');

    // Generate Board Cells
    const board = document.getElementById('ludo-board');
    for(let i=0; i<225; i++) {
        let cell = document.createElement('div');
        cell.className = 'cell';
        board.appendChild(cell);
    }

    // Path Logic
    const redPath = [[6,1],[6,2],[6,3],[6,4],[6,5],[5,6],[4,6],[3,6],[2,6],[1,6],[0,6],[0,7],[0,8],[1,8],[2,8],[3,8],[4,8],[5,8],[6,9],[6,10],[6,11],[6,12],[6,13],[6,14],[7,14],[8,14],[8,13],[8,12],[8,11],[8,10],[8,9],[9,8],[10,8],[11,8],[12,8],[13,8],[14,8],[14,7],[14,6],[13,6],[12,6],[11,6],[10,6],[9,5],[8,4],[8,3],[8,2],[8,1],[8,0],[7,0],[7,1],[7,2],[7,3],[7,4],[7,5],[7,6]];

    // Create Tokens
    const redGoti = document.createElement('div');
    redGoti.className = 'token';
    redGoti.style.backgroundColor = 'var(--red)';
    board.appendChild(redGoti);

    let myRole = "";
    let gameState = { turn: 'red', dice: 0, redPos: -1 };

    window.handleRoll = () => {
        if(gameState.turn !== myRole) return;
        const roll = Math.floor(Math.random() * 6) + 1;
        let nextPos = gameState.redPos + roll;
        if(nextPos >= redPath.length) nextPos = 0; // Reset logic for demo
        
        update(gameRef, { 
            dice: roll, 
            redPos: nextPos,
            turn: 'red' // Keeping it simple for testing
        });
    };

    onValue(gameRef, (snap) => {
        const data = snap.val();
        if(!data) return set(gameRef, gameState);
        gameState = data;

        document.getElementById('dice-val').innerText = data.dice;
        document.getElementById('status-bar').innerText = (data.turn === myRole) ? "AAPKI BAARI!" : "DOST KI BAARI...";
        
        // Update Goti Position
        if(data.redPos >= 0) {
            const coords = redPath[data.redPos];
            redGoti.style.gridColumn = coords[0] + 1;
            redGoti.style.gridRow = coords[1] + 1;
        } else {
            redGoti.style.gridColumn = 2; redGoti.style.gridRow = 2;
        }
    });

    window.onload = () => {
        myRole = 'red'; // Aap hamesha Red rahenge testing ke liye
        document.getElementById('player-tag').innerText = "Aap: RED";
    };
</script>
</body>
</html>
