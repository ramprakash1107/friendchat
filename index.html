<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Tic Tac Toe + Chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  background:#000;
  color:#fff;
  font-family:sans-serif;
  text-align:center;
}
input,button{
  padding:12px;
  font-size:16px;
  margin:5px;
  border-radius:6px;
}
button{cursor:pointer}
.hidden{display:none}

#board{
  display:grid;
  grid-template-columns:repeat(3,90px);
  gap:8px;
  justify-content:center;
  margin:15px auto;
}
.cell{
  width:90px;height:90px;
  background:#111;
  font-size:42px;
  display:flex;
  align-items:center;
  justify-content:center;
}

#chatBox{
  max-width:300px;
  margin:10px auto;
  background:#111;
  border-radius:8px;
  padding:5px;
}
#messages{
  height:120px;
  overflow-y:auto;
  text-align:left;
  font-size:14px;
}
.msg{margin:4px}
.me{color:#1d9bf0}
.other{color:#fff}
</style>
</head>

<body>

<h2>ðŸŽ® Tic Tac Toe Online</h2>

<div id="joinBox">
  <input id="nameInput" placeholder="Your name">
  <br>
  <input id="roomInput" placeholder="5 digit room code">
  <br>
  <button onclick="joinRoom()">Join Room</button>
</div>

<h3 id="status"></h3>

<div id="board" class="hidden"></div>

<button id="restartBtn" class="hidden" onclick="restart()">Restart</button>

<!-- CHAT -->
<div id="chatBox" class="hidden">
  <div id="messages"></div>
  <input id="chatInput" placeholder="Message...">
  <button onclick="sendMsg()">Send</button>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// ðŸ”´ APNA FIREBASE CONFIG YAHI PASTE KARO
firebase.initializeApp({
  apiKey: "API_KEY",
  authDomain: "PROJECT.firebaseapp.com",
  databaseURL: "https://PROJECT-default-rtdb.firebaseio.com",
  projectId: "PROJECT"
});

const db = firebase.database();

let roomId, mySymbol, myName, gameRef, chatRef;

/* BOARD CREATE */
const boardDiv=document.getElementById("board");
for(let i=0;i<9;i++){
  const d=document.createElement("div");
  d.className="cell";
  d.onclick=()=>move(i);
  boardDiv.appendChild(d);
}

function joinRoom(){
  myName = nameInput.value.trim();
  roomId = roomInput.value.trim();

  if(!myName){ alert("Name likho"); return; }
  if(roomId.length!==5){ alert("5 digit room code"); return; }

  gameRef = db.ref("rooms/"+roomId+"/game");
  chatRef = db.ref("rooms/"+roomId+"/chat");

  gameRef.once("value", snap=>{
    let g = snap.val();
    if(!g){
      mySymbol="X";
      gameRef.set({
        board:["","","","","","","","",""],
        turn:"X",
        players:{X:myName}
      });
    }else if(!g.players.O){
      mySymbol="O";
      g.players.O=myName;
      gameRef.update({players:g.players});
    }else{
      alert("Room full");
      return;
    }

    joinBox.classList.add("hidden");
    boardDiv.classList.remove("hidden");
    chatBox.classList.remove("hidden");

    listenGame();
    listenChat();
  });
}

function listenGame(){
  gameRef.on("value", snap=>{
    const g=snap.val();
    if(!g) return;

    g.board.forEach((v,i)=>{
      boardDiv.children[i].innerText=v;
    });

    status.innerText =
      g.turn===mySymbol ? "ðŸ‘‰ Aapki baari" : "â³ Opponent ki baari";

    const w=winner(g.board);
    if(w){
      status.innerText = w==="draw" ? "ðŸ¤ Draw" : "ðŸ† Winner: "+w;
      restartBtn.classList.remove("hidden");
    }
  });
}

function move(i){
  gameRef.once("value", snap=>{
    const g=snap.val();
    if(g.turn!==mySymbol) return;
    if(g.board[i]!=="" ) return;

    g.board[i]=mySymbol;
    g.turn = mySymbol==="X"?"O":"X";
    gameRef.update(g);
  });
}

function restart(){
  gameRef.update({
    board:["","","","","","","","",""],
    turn:"X"
  });
  restartBtn.classList.add("hidden");
}

/* CHAT */
function sendMsg(){
  const text=chatInput.value.trim();
  if(!text) return;
  chatRef.push({
    name:myName,
    msg:text,
    time:Date.now()
  });
  chatInput.value="";
}

function listenChat(){
  chatRef.limitToLast(50).on("child_added", snap=>{
    const m=snap.val();
    const d=document.createElement("div");
    d.className="msg "+(m.name===myName?"me":"other");
    d.innerText=m.name+": "+m.msg;
    messages.appendChild(d);
    messages.scrollTop=messages.scrollHeight;
  });
}

/* WIN LOGIC */
function winner(b){
  const w=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
  for(let a of w){
    if(b[a[0]] && b[a[0]]===b[a[1]] && b[a[1]]===b[a[2]]) return b[a[0]];
  }
  return b.includes("")?null:"draw";
}
</script>
</body>
</html>
