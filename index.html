<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tic Tac Toe Online</title>

<style>
body{
  margin:0;
  font-family:system-ui;
  background:#000;
  color:#fff;
  text-align:center;
}
#login{padding:20px}
input,button{
  width:100%;
  padding:14px;
  margin:10px 0;
  border-radius:12px;
  border:none;
  font-size:16px;
}
input{background:#111;color:#fff}
button{background:#1d9bf0;color:#fff;font-weight:bold}
#game{display:none;padding:20px}
#status{margin:10px 0}
#board{
  display:grid;
  grid-template-columns:repeat(3,90px);
  gap:10px;
  justify-content:center;
  margin:20px auto;
}
.cell{
  width:90px;
  height:90px;
  background:#1e1e1e;
  font-size:36px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:12px;
  cursor:pointer;
}
</style>
</head>

<body>

<div id="login">
  <h2>ðŸŽ® Tic Tac Toe</h2>
  <input id="roomInput" placeholder="Room code">
  <button id="joinBtn">Join Game</button>
</div>

<div id="game">
  <div id="status"></div>
  <div id="board"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getDatabase, ref, set, update, get, onValue }
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

/* ðŸ”¥ FIREBASE CONFIG (same as yours) */
const firebaseConfig = {
  apiKey: "AIzaSyARuO_pN2vdYrVKYkKHHaNys7WI8HqM6I4",
  authDomain: "friendchat-43941.firebaseapp.com",
  databaseURL: "https://friendchat-43941-default-rtdb.firebaseio.com",
  projectId: "friendchat-43941"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ELEMENTS */
const roomInput = document.getElementById("roomInput");
const joinBtn = document.getElementById("joinBtn");
const login = document.getElementById("login");
const game = document.getElementById("game");
const statusDiv = document.getElementById("status");
const boardDiv = document.getElementById("board");

/* STATE */
let roomId = "";
let player = "";
let board = ["","","","","","","","",""];
let turn = "X";

/* BOARD UI */
for(let i=0;i<9;i++){
  const cell = document.createElement("div");
  cell.className = "cell";
  cell.onclick = () => move(i);
  boardDiv.appendChild(cell);
}

/* JOIN (100% SAFE) */
joinBtn.onclick = async () => {
  roomId = roomInput.value.trim();
  if(!roomId){
    alert("Room code likho");
    return;
  }

  const roomRef = ref(db,"ttt/"+roomId);
  const snap = await get(roomRef);

  if(!snap.exists()){
    // First player
    player = "X";
    await set(roomRef,{
      board: ["","","","","","","","",""],
      turn: "X",
      players: { X:true, O:false }
    });
  }else{
    const data = snap.val();
    if(!data.players.O){
      // Second player
      player = "O";
      await update(roomRef,{
        "players/O": true
      });
    }else{
      alert("Room full ho chuka hai");
      return;
    }
  }

  login.style.display = "none";
  game.style.display = "block";
  statusDiv.innerText = "You are " + player;

  // realtime sync
  onValue(roomRef, snap=>{
    const d = snap.val();
    board = d.board;
    turn = d.turn;
    updateUI();
  });
};

/* MOVE */
function move(i){
  if(board[i] || turn !== player) return;
  board[i] = player;
  turn = player === "X" ? "O" : "X";
  update(ref(db,"ttt/"+roomId),{ board, turn });
}

/* UI */
function updateUI(){
  document.querySelectorAll(".cell").forEach((c,i)=>{
    c.innerText = board[i];
  });
  statusDiv.innerText = (turn === player)
    ? "Your Turn"
    : "Opponent Turn";
}
</script>

</body>
</html>
