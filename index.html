<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>RP_GUPTA_07 | 3D PRO ARENA</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, viewport-fit=cover">

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Orbitron:wght@900&display=swap" rel="stylesheet">

<style>
:root { 
    --p1: #ff0055; --p2: #00f2ff; --accent: #ffb400;
    --bg: #050505; --glass: rgba(255, 255, 255, 0.1);
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }

body, html { 
    margin: 0; padding: 0; width: 100%; height: 100%;
    background: var(--bg); color: #fff; font-family: 'Rajdhani', sans-serif;
    overflow: hidden; 
}

/* 3D Moving Wallpaper Background */
.bg-3d {
    position: fixed; inset: -50px; z-index: -1;
    background: radial-gradient(circle at center, #111, #000);
    perspective: 1000px;
}
.bg-grid {
    position: absolute; width: 200%; height: 200%;
    background-image: linear-gradient(rgba(0, 242, 255, 0.1) 1px, transparent 1px), 
                      linear-gradient(90deg, rgba(0, 242, 255, 0.1) 1px, transparent 1px);
    background-size: 60px 60px;
    transform: rotateX(60deg) translateZ(-200px);
    animation: scroll 20s linear infinite;
}
@keyframes scroll { from { transform: rotateX(60deg) translateY(0); } to { transform: rotateX(60deg) translateY(60px); } }

.main-app {
    width: 100%; max-width: 450px; margin: auto; height: 100vh;
    display: flex; flex-direction: column; position: relative;
    background: rgba(0,0,0,0.8); backdrop-filter: blur(20px);
}

/* 3D Home Text */
.home-screen { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 30px; }
.title-3d { 
    font-family: 'Black Ops One', cursive; font-size: 50px; color: var(--accent);
    text-shadow: 0 1px 0 #ccc, 0 2px 0 #c9c9c9, 0 3px 0 #bbb, 0 4px 0 #b9b9b9, 0 5px 0 #aaa, 0 6px 1px rgba(0,0,0,.1), 0 0 5px rgba(0,0,0,.1), 0 1px 3px rgba(0,0,0,.3), 0 3px 5px rgba(0,0,0,.2), 0 5px 10px rgba(0,0,0,.25), 0 10px 10px rgba(0,0,0,.2), 0 20px 20px rgba(0,0,0,.15);
    transform: rotateX(10deg) rotateY(-10deg); margin-bottom: 20px;
}

.input-pro {
    width: 100%; padding: 20px; border: 2px solid var(--accent); background: #000;
    color: #fff; font-family: 'Orbitron'; font-size: 16px; margin-bottom: 15px;
    border-radius: 12px; box-shadow: inset 0 0 10px var(--accent);
}

.btn-3d {
    width: 100%; padding: 20px; border: none; font-family: 'Orbitron'; font-weight: 900;
    font-size: 14px; cursor: pointer; border-radius: 12px; margin-bottom: 15px;
    background: linear-gradient(to bottom, var(--accent), #cc9000);
    box-shadow: 0 8px 0 #805a00; transform: translateY(-4px); transition: 0.1s;
}
.btn-3d:active { transform: translateY(0); box-shadow: 0 0 0 #805a00; }

/* Arena 3D Board */
.arena-screen { flex: 1; display: flex; flex-direction: column; }
.board-container { perspective: 1200px; padding: 50px 0; display: flex; justify-content: center; }
#board { 
    display: grid; grid-template-columns: repeat(3, 100px); gap: 15px;
    transform: rotateX(30deg) rotateY(0deg); transform-style: preserve-3d;
}
.cell { 
    width: 100px; height: 100px; background: #111; border: 3px solid #222;
    display: flex; align-items: center; justify-content: center; font-size: 50px;
    border-radius: 10px; box-shadow: 0 10px 0 #000; transition: 0.1s;
}
.cell.X { color: var(--p1); text-shadow: 0 0 20px var(--p1); }
.cell.O { color: var(--p2); text-shadow: 0 0 20px var(--p2); }

/* Chat & HUD */
.hud { padding: 15px; display: flex; justify-content: space-between; align-items: center; background: #000; border-bottom: 2px solid var(--accent); }
.score-card { font-family: 'Orbitron'; font-size: 25px; }

.hidden { display: none !important; }
</style>
</head>
<body>

<div class="bg-3d"><div class="bg-grid"></div></div>

<div class="main-app">
    <div id="home" class="home-screen">
        <div class="title-3d">ELITE 07</div>
        <div style="font-size:12px; color:var(--accent); letter-spacing:5px; margin-bottom:40px;">GOD MODE ARENA</div>

        <input id="uName" class="input-pro" placeholder="CALLSIGN (NICKNAME)">
        
        <button class="btn-3d" onclick="init('X', true)">CREATE 3D BATTLE</button>
        <div style="display:flex; gap:10px; width:100%;">
            <input id="roomCode" class="input-pro" style="margin:0; flex:1;" placeholder="CODE">
            <button class="btn-3d" style="width:100px; margin:0; background:var(--p2); box-shadow:0 8px 0 #00a2aa;" onclick="init('O', false)">JOIN</button>
        </div>
        <button class="btn-3d" style="background:#fff; color:#000; box-shadow:0 8px 0 #888;" onclick="initAI()">VS GOD-BOT (UNBEATABLE)</button>
        
        <div style="margin-top:20px; font-size:10px; opacity:0.5;">ADMIN: @RP_GUPTA_07</div>
    </div>

    <div id="arena" class="arena-screen hidden">
        <div class="hud">
            <div onclick="exitGame()" style="color:var(--p1); font-weight:900;">[ EXIT ]</div>
            <div id="turnStatus" style="color:var(--accent)">X TURN</div>
            <div id="roomID" style="opacity:0.4;">#0000</div>
        </div>

        <div style="display:flex; justify-content:space-around; padding:20px;">
            <div style="text-align:center;"><small id="p1Name">P1</small><div class="score-card" id="s1" style="color:var(--p1)">0</div></div>
            <div style="align-self:center; opacity:0.2; font-family:'Orbitron'">VS</div>
            <div style="text-align:center;"><small id="p2Name">P2</small><div class="score-card" id="s2" style="color:var(--p2)">0</div></div>
        </div>

        <div class="board-container">
            <div id="board"></div>
        </div>

        <div style="flex:1; background:#000; border-top:1px solid #222; display:flex; flex-direction:column;">
            <div id="chatBox" style="flex:1; overflow-y:auto; padding:10px; font-size:12px;"></div>
            <div style="display:flex; padding:10px; border-top:1px solid #111;">
                <input id="chatInp" style="flex:1; background:none; border:none; color:#fff;" placeholder="Secure message...">
                <button onclick="sendChat()" style="color:var(--accent); background:none; border:none; font-weight:900;">SEND</button>
            </div>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyARuO_pN2vdYrVKYkKHHaNys7WI8HqM6I4",
    authDomain: "friendchat-43941.firebaseapp.com",
    databaseURL: "https://friendchat-43941-default-rtdb.firebaseio.com",
    projectId: "friendchat-43941",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let roomID, mySym, isAI = false, userN;

function init(s, host) {
    userN = document.getElementById('uName').value || "PLAYER";
    roomID = host ? Math.random().toString(36).substr(2,6).toUpperCase() : document.getElementById('roomCode').value.toUpperCase();
    mySym = s; start();
}

function initAI() {
    userN = document.getElementById('uName').value || "USER";
    roomID = "BOT_" + Math.floor(Math.random()*9999);
    isAI = true; mySym = "X"; start();
}

function start() {
    document.getElementById('home').classList.add('hidden');
    document.getElementById('arena').classList.remove('hidden');
    document.getElementById('roomID').innerText = "#" + roomID;

    const ref = db.ref("arena_3d/"+roomID);
    if(mySym === "X") {
        ref.set({ b: Array(9).fill(""), t: "X", p1: userN, p2: isAI ? "ROBO-GOD" : "WAITING...", s1: 0, s2: 0 });
    } else {
        ref.child("p2").set(userN);
    }
    sync();
}

function sync() {
    db.ref("arena_3d/"+roomID).on("value", s => {
        const d = s.val(); if(!d) return;
        document.getElementById('p1Name').innerText = d.p1;
        document.getElementById('p2Name').innerText = d.p2;
        document.getElementById('s1').innerText = d.s1;
        document.getElementById('s2').innerText = d.s2;
        document.getElementById('turnStatus').innerText = d.t + " TURN";
        
        const b = document.getElementById('board'); b.innerHTML = "";
        d.b.forEach((v, i) => {
            const c = document.createElement('div');
            c.className = "cell " + v; c.innerText = v;
            c.onclick = () => move(i); b.appendChild(c);
        });

        const win = check(d.b);
        if(win) {
            if(win === mySym) { confetti({particleCount:200}); }
            setTimeout(() => { db.ref("arena_3d/"+roomID).update({ b: Array(9).fill(""), t: "X" }); }, 2000);
        } else if(isAI && d.t === "O") {
            setTimeout(() => botLogic(d), 600);
        }
    });
}

function move(i) {
    db.ref("arena_3d/"+roomID).once("value", s => {
        const d = s.val();
        if(d.t !== mySym || d.b[i] !== "" || check(d.b)) return;
        
        d.b[i] = mySym;
        d.t = (mySym === "X" ? "O" : "X"); // Turn Switch
        
        const w = check(d.b);
        if(w && w !== "DRAW") { if(w === "X") d.s1++; else d.s2++; }
        db.ref("arena_3d/"+roomID).update(d);
    });
}

function check(b) {
    const l = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
    for(let i of l) if(b[i[0]] && b[i[0]]===b[i[1]] && b[i[1]]===b[i[2]]) return b[i[0]];
    return b.includes("") ? null : "DRAW";
}

// Bot Logic (Minimax - Unbeatable)
function botLogic(d) {
    let board = [...d.b];
    let best = -Infinity; let m;
    for(let i=0; i<9; i++) {
        if(board[i] === "") {
            board[i] = "O"; let score = minimax(board, false); board[i] = "";
            if(score > best) { best = score; m = i; }
        }
    }
    d.b[m] = "O"; d.t = "X";
    const w = check(d.b); if(w === "O") d.s2++;
    db.ref("arena_3d/"+roomID).update(d);
}

function minimax(b, isMax) {
    let r = check(b);
    if(r === "O") return 10; if(r === "X") return -10; if(r === "DRAW") return 0;
    let scores = [];
    for(let i=0; i<9; i++) {
        if(b[i] === "") {
            b[i] = isMax ? "O" : "X";
            scores.push(minimax(b, !isMax));
            b[i] = "";
        }
    }
    return isMax ? Math.max(...scores) : Math.min(...scores);
}

function exitGame() {
    if(confirm("DELETE DATA & EXIT?")) {
        db.ref("arena_3d/"+roomID).remove();
        db.ref("chats_3d/"+roomID).remove();
        location.reload();
    }
}

// Chat
function sendChat() {
    const i = document.getElementById('chatInp');
    if(i.value) { db.ref("chats_3d/"+roomID).push({ n: userN, m: i.value }); i.value = ""; }
}
db.ref("chats_3d/"+roomID).on("child_added", s => {
    const d = s.val(); const div = document.createElement('div');
    div.innerHTML = `<b style="color:var(--accent)">${d.n}:</b> ${d.m}`;
    document.getElementById('chatBox').appendChild(div);
    document.getElementById('chatBox').scrollTop = 999;
});
</script>
</body>
</html>
