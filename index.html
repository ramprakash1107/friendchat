<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>RP_GUPTA_07 | ULTIMATE 3D ARENA</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, viewport-fit=cover">

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">

<style>
:root { 
    --p1: #ff0055; --p2: #00f2ff; --gold: #ffb400;
    --dark: #000; --glass: rgba(255, 255, 255, 0.05);
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }

body, html { 
    margin: 0; padding: 0; width: 100%; height: 100%;
    background: var(--dark); color: #fff; font-family: 'Orbitron', sans-serif;
    overflow: hidden; -webkit-font-smoothing: antialiased;
}

/* 3D Animated Wallpaper */
.bg-layer {
    position: fixed; inset: 0; z-index: -1;
    background: radial-gradient(circle at center, #111 0%, #000 100%);
}
.bg-grid {
    position: absolute; width: 300%; height: 300%; top: -100%; left: -100%;
    background-image: 
        linear-gradient(rgba(255, 0, 85, 0.1) 2px, transparent 2px),
        linear-gradient(90deg, rgba(255, 0, 85, 0.1) 2px, transparent 2px);
    background-size: 80px 80px;
    transform: perspective(1000px) rotateX(60deg);
    animation: move-grid 15s linear infinite;
}
@keyframes move-grid { from { transform: perspective(1000px) rotateX(60deg) translateY(0); } to { transform: perspective(1000px) rotateX(60deg) translateY(80px); } }

.app-container {
    width: 100%; max-width: 450px; margin: auto; height: 100%;
    display: flex; flex-direction: column; background: rgba(0,0,0,0.7);
    backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
    border-left: 1px solid #222; border-right: 1px solid #222;
}

/* Home Screen - Deep 3D */
.screen { flex: 1; display: flex; flex-direction: column; padding: 30px; align-items: center; justify-content: center; }
.hero-text { 
    font-family: 'Black Ops One', cursive; font-size: 55px; color: #fff;
    text-shadow: 0 5px 15px var(--p1), 0 10px 30px #000;
    transform: rotateX(10deg); margin-bottom: 5px;
}
.admin-sub { color: var(--gold); font-size: 10px; letter-spacing: 5px; margin-bottom: 40px; text-transform: uppercase; }

.btn-pro {
    width: 100%; padding: 22px; border: none; font-family: 'Orbitron'; font-weight: 900;
    font-size: 14px; cursor: pointer; margin-bottom: 15px; border-radius: 15px;
    background: linear-gradient(145deg, #222, #000); color: #fff;
    border: 1px solid #333; box-shadow: 0 10px 20px rgba(0,0,0,0.5);
    transition: 0.2s;
}
.btn-pro:active { transform: scale(0.98); background: var(--p1); }
.btn-gold { background: var(--gold); color: #000; border: none; }

.input-pro {
    width: 100%; padding: 20px; border-radius: 15px; border: 1px solid #333;
    background: #000; color: #fff; font-family: 'Orbitron'; margin-bottom: 15px;
    text-align: center; font-size: 16px;
}

/* 3D Battle Board */
.board-3d-scene { perspective: 1200px; padding: 40px 0; }
#board { 
    display: grid; grid-template-columns: repeat(3, 105px); gap: 12px;
    transform: rotateX(25deg) rotateY(-5deg); transform-style: preserve-3d;
}
.cell { 
    width: 105px; height: 105px; background: rgba(15,15,15,0.9);
    border: 2px solid #222; border-radius: 12px; display: flex;
    align-items: center; justify-content: center; font-size: 55px;
    box-shadow: 0 8px 0 #000, 0 15px 25px rgba(0,0,0,0.5); transition: 0.1s;
}
.cell:active { transform: translateZ(-10px); box-shadow: 0 0 0 #000; }
.cell.X { color: var(--p1); text-shadow: 0 0 20px var(--p1); }
.cell.O { color: var(--p2); text-shadow: 0 0 20px var(--p2); }

/* HUD & Status */
.hud { width: 100%; padding: 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #222; }
.turn-indicator { color: var(--gold); font-size: 14px; font-weight: 900; text-transform: uppercase; }

.chat-box { height: 150px; background: #000; display: flex; flex-direction: column; border-top: 1px solid var(--gold); }
#msgList { flex: 1; overflow-y: auto; padding: 15px; font-size: 13px; }

.hidden { display: none !important; }
</style>
</head>
<body>

<div class="bg-layer"><div class="bg-grid"></div></div>

<div class="app-container">
    <div id="home" class="screen">
        <div class="hero-text">ARENA 07</div>
        <div class="admin-sub">ADMIN: @RP_GUPTA_07</div>

        <input id="uNick" class="input-pro" placeholder="NICKNAME">
        <button class="btn-pro btn-gold" onclick="launch('X', true)">CREATE 3D MATCH</button>
        
        <div style="display:flex; gap:10px; width:100%;">
            <input id="rInp" class="input-pro" style="margin:0; flex:1;" placeholder="CODE">
            <button class="btn-pro" style="width:100px; margin:0; border-color:var(--p2); color:var(--p2);" onclick="launch('O', false)">JOIN</button>
        </div>

        <button class="btn-pro" style="background:var(--p1); border:none;" onclick="launchAI()">ENGAGE GOD-BOT (IMPOSSIBLE)</button>
        
        <div style="margin-top:20px; display:grid; grid-template-columns:1fr 1fr; gap:10px; width:100%;">
            <div style="background:var(--glass); padding:10px; border-radius:10px; font-size:10px; text-align:center;">SERVERS<br><b style="color:var(--p2)">ONLINE</b></div>
            <div style="background:var(--glass); padding:10px; border-radius:10px; font-size:10px; text-align:center;">RANK<br><b style="color:var(--gold)">ELITE</b></div>
        </div>
    </div>

    <div id="arena" class="hidden" style="height:100%; display:flex; flex-direction:column;">
        <div class="hud">
            <div onclick="nuke()" style="color:var(--p1); font-weight:900; cursor:pointer;">[ TERMINATE ]</div>
            <div id="turnTag" class="turn-indicator">X'S TURN</div>
            <div id="roomTag" style="opacity:0.4; font-size:10px;">#0000</div>
        </div>

        <div style="display:flex; justify-content:space-around; padding:20px; background:rgba(255,255,255,0.02);">
            <div style="text-align:center;"><small id="p1N">P1</small><div id="s1" style="font-size:32px; color:var(--p1); font-weight:900;">0</div></div>
            <div style="align-self:center; font-size:20px; opacity:0.1;">VS</div>
            <div style="text-align:center;"><small id="p2N">P2</small><div id="s2" style="font-size:32px; color:var(--p2); font-weight:900;">0</div></div>
        </div>

        <div class="screen" style="padding:0;">
            <div class="board-3d-scene"><div id="board"></div></div>
        </div>

        <div class="chat-box">
            <div id="msgList"></div>
            <div style="display:flex; padding:10px; gap:8px;">
                <input id="cMsg" style="flex:1; background:#111; border:1px solid #222; color:#fff; padding:10px; border-radius:8px;" placeholder="Secure Comms...">
                <button onclick="sendChat()" style="background:var(--gold); border:none; border-radius:8px; padding:0 15px; font-weight:900;">></button>
            </div>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// Firebase Engine
const firebaseConfig = {
    apiKey: "AIzaSyARuO_pN2vdYrVKYkKHHaNys7WI8HqM6I4",
    authDomain: "friendchat-43941.firebaseapp.com",
    databaseURL: "https://friendchat-43941-default-rtdb.firebaseio.com",
    projectId: "friendchat-43941",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let rId, sym, isBot = false, nick;

function launch(s, host) {
    nick = document.getElementById('uNick').value || "PLAYER";
    rId = host ? Math.random().toString(36).substr(2,6).toUpperCase() : document.getElementById('rInp').value.toUpperCase();
    sym = s; start();
}

function launchAI() {
    nick = document.getElementById('uNick').value || "USER";
    rId = "BOT_" + Math.floor(Math.random()*999);
    isBot = true; sym = "X"; start();
}

function start() {
    document.getElementById('home').classList.add('hidden');
    document.getElementById('arena').classList.remove('hidden');
    document.getElementById('roomTag').innerText = "#" + rId;

    const ref = db.ref("arena_v2/"+rId);
    if(sym === "X") {
        ref.set({ b: Array(9).fill(""), t: "X", p1: nick, p2: isBot ? "GOD-BOT" : "CONNECTING...", s1: 0, s2: 0 });
    } else {
        ref.child("p2").set(nick);
    }
    sync();
    syncChat();
}

function sync() {
    db.ref("arena_v2/"+rId).on("value", s => {
        const d = s.val(); if(!d) return;
        document.getElementById('p1N').innerText = d.p1;
        document.getElementById('p2N').innerText = d.p2;
        document.getElementById('s1').innerText = d.s1;
        document.getElementById('s2').innerText = d.s2;
        document.getElementById('turnTag').innerText = d.t + "'S TURN";
        
        const b = document.getElementById('board'); b.innerHTML = "";
        d.b.forEach((v, i) => {
            const c = document.createElement('div');
            c.className = "cell " + v; c.innerText = v;
            c.onclick = () => tap(i); b.appendChild(c);
        });

        const win = check(d.b);
        if(win) {
            if(win === sym) confetti({particleCount: 250, spread: 70, origin: { y: 0.6 }});
            setTimeout(() => { db.ref("arena_v2/"+rId).update({ b: Array(9).fill(""), t: "X" }); }, 2000);
        } else if(isBot && d.t === "O") {
            setTimeout(() => botBrain(d), 600);
        }
    });
}

function tap(i) {
    db.ref("arena_v2/"+rId).once("value", s => {
        const d = s.val();
        if(d.t !== sym || d.b[i] !== "" || check(d.b)) return;
        d.b[i] = sym;
        d.t = (sym === "X" ? "O" : "X");
        const w = check(d.b);
        if(w && w !== "DRAW") { if(w === "X") d.s1++; else d.s2++; }
        db.ref("arena_v2/"+rId).update(d);
    });
}

function check(b) {
    const lines = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
    for(let l of lines) if(b[l[0]] && b[l[0]]===b[l[1]] && b[l[1]]===b[l[2]]) return b[l[0]];
    return b.includes("") ? null : "DRAW";
}

// God-Bot (Impossible Minimax)
function botBrain(d) {
    let board = [...d.b];
    let best = -Infinity; let move;
    for(let i=0; i<9; i++) {
        if(board[i] === "") {
            board[i] = "O"; let score = minimax(board, false); board[i] = "";
            if(score > best) { best = score; move = i; }
        }
    }
    d.b[move] = "O"; d.t = "X";
    const w = check(d.b); if(w === "O") d.s2++;
    db.ref("arena_v2/"+rId).update(d);
}

function minimax(b, isMax) {
    let r = check(b);
    if(r === "O") return 10; if(r === "X") return -10; if(r === "DRAW") return 0;
    let scores = [];
    for(let i=0; i<9; i++) {
        if(b[i] === "") {
            b[i] = isMax ? "O" : "X";
            scores.push(minimax(b, !isMax));
            b[i] = "";
        }
    }
    return isMax ? Math.max(...scores) : Math.min(...scores);
}

function nuke() {
    if(confirm("WIPE DATA & EXIT?")) {
        db.ref("arena_v2/"+rId).remove();
        db.ref("chat_v2/"+rId).remove();
        location.reload();
    }
}

function sendChat() {
    const i = document.getElementById('cMsg');
    if(i.value) { db.ref("chat_v2/"+rId).push({ n: nick, m: i.value }); i.value = ""; }
}
function syncChat() {
    db.ref("chat_v2/"+rId).on("child_added", s => {
        const d = s.val(); const div = document.createElement('div');
        div.innerHTML = `<b style="color:var(--gold)">${d.n}:</b> ${d.m}`;
        document.getElementById('msgList').appendChild(div);
        document.getElementById('msgList').scrollTop = 999;
    });
}
</script>
</body>
</html>
