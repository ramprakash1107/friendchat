<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tic Tac Toe Online</title>

<style>
body{
  margin:0;
  font-family:system-ui;
  background:#000;
  color:#fff;
  text-align:center;
}
#login{padding:20px}
input,button{
  width:100%;
  padding:14px;
  margin:10px 0;
  border-radius:10px;
  border:none;
  font-size:16px;
}
input{background:#111;color:#fff}
button{background:#1d9bf0;color:#fff;font-weight:bold}
#game{display:none}
#board{
  display:grid;
  grid-template-columns:repeat(3,90px);
  gap:10px;
  justify-content:center;
  margin:20px auto;
}
.cell{
  width:90px;
  height:90px;
  background:#222;
  font-size:36px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:12px;
  cursor:pointer;
}
</style>
</head>

<body>

<div id="login">
  <h2>ðŸŽ® Tic Tac Toe</h2>
  <input id="room" placeholder="Room code (same dono phone me)">
  <button onclick="join()">Join Game</button>
</div>

<div id="game">
  <h3 id="status"></h3>
  <div id="board"></div>
</div>

<!-- Firebase COMPAT SDK (MOST STABLE) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* ðŸ”¥ Firebase config */
firebase.initializeApp({
  apiKey: "AIzaSyARuO_pN2vdYrVKYkKHHaNys7WI8HqM6I4",
  authDomain: "friendchat-43941.firebaseapp.com",
  databaseURL: "https://friendchat-43941-default-rtdb.firebaseio.com",
  projectId: "friendchat-43941"
});

const db = firebase.database();

let roomId="", player="", board=[], turn="X";

/* UI board */
const boardDiv=document.getElementById("board");
for(let i=0;i<9;i++){
  const d=document.createElement("div");
  d.className="cell";
  d.onclick=()=>play(i);
  boardDiv.appendChild(d);
}

/* JOIN â€” SIMPLE + GUARANTEED */
function join(){
  roomId=document.getElementById("room").value.trim();
  if(!roomId){ alert("Room code likho"); return; }

  const ref=db.ref("ttt/"+roomId);

  ref.once("value", snap=>{
    if(!snap.exists()){
      player="X";
      ref.set({
        board:["","","","","","","","",""],
        turn:"X",
        players:{X:true,O:false}
      });
    }else{
      const d=snap.val();
      if(d.players.O){ alert("Room full"); return; }
      player="O";
      ref.child("players/O").set(true);
    }

    document.getElementById("login").style.display="none";
    document.getElementById("game").style.display="block";
    document.getElementById("status").innerText="You are "+player;

    ref.on("value", s=>{
      const d=s.val();
      board=d.board;
      turn=d.turn;
      updateUI();
    });
  });
}

/* PLAY */
function play(i){
  if(board[i] || turn!==player) return;
  board[i]=player;
  turn=player==="X"?"O":"X";
  db.ref("ttt/"+roomId).update({board,turn});
}

/* UI */
function updateUI(){
  document.querySelectorAll(".cell").forEach((c,i)=>{
    c.innerText=board[i];
  });
  document.getElementById("status").innerText=
    (turn===player)?"Your Turn":"Opponent Turn";
}
</script>

</body>
</html>
