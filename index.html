<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>@rp_gupta_07 | Elite Arena Pro</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, viewport-fit=cover">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { 
            --primary: #00f2ff; --secondary: #7000ff; --bg: #050505; 
            --win: #00ff88; --accent: #ff0055;
            --wood: url('https://i.imgur.com/8Yv2LQX.jpg'); /* Wooden Texture */
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html { margin: 0; padding: 0; height: 100%; width: 100%; background: var(--bg); color: #fff; font-family: 'Segoe UI', sans-serif; overflow: hidden; position: fixed; }
        
        .container { display: flex; flex-direction: column; height: 100%; max-width: 450px; margin: auto; position: relative; }
        .screen { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        
        /* Wooden Board Styling */
        #board { 
            display: grid; gap: 10px; margin: 15px auto; 
            background-image: var(--wood); 
            background-size: cover; padding: 15px; 
            border-radius: 15px; border: 8px solid #3d2b1f;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .cell { 
            background: rgba(0, 0, 0, 0.3); border-radius: 8px; 
            display: flex; align-items: center; justify-content: center; 
            font-weight: 900; cursor: pointer; border: 1px solid rgba(255,255,255,0.1);
            transition: transform 0.1s;
        }
        .cell:active { transform: scale(0.9); }
        
        /* Animations for X and O */
        .symbol-anim { animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes pop { 0% { transform: scale(0); } 100% { transform: scale(1); } }

        .hero-title { font-size: 42px; font-weight: 900; text-align: center; margin: 0; background: linear-gradient(#fff, #aaa); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        input { width: 100%; padding: 15px; border-radius: 12px; border: 1px solid #222; background: #15151b; color: #fff; margin-bottom: 10px; }
        .btn-main { width: 100%; padding: 16px; border-radius: 12px; border: none; font-weight: 800; cursor: pointer; text-transform: uppercase; margin-bottom: 8px; }
        .btn-primary { background: var(--primary); color: #000; }
        
        .scoreboard { display: flex; gap: 20px; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 15px; width: 100%; justify-content: center; }
        .active-turn { border: 2px solid var(--primary); box-shadow: 0 0 15px var(--primary); }
        
        #winnerOverlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 999; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div id="winnerOverlay">
    <h1 id="winnerName" style="font-size: 50px; color: var(--win);">WINNER!</h1>
    <button id="nextRoundBtn" class="btn-main btn-primary" style="width:200px;">NEXT ROUND</button>
</div>

<div class="container">
    <div id="loginScreen" class="screen">
        <h1 class="hero-title">ELITE ARENA</h1>
        <p style="color:var(--primary); letter-spacing: 5px;">BY @RP_GUPTA_07</p>
        <input id="userName" placeholder="ENTER PLAYER NAME">
        <button id="createBtn" class="btn-main btn-primary">CREATE ARENA</button>
        <button id="robotBtn" class="btn-main" style="background:#fff;">VS ROBOT</button>
        <input id="joinCode" placeholder="ARENA CODE" style="margin-top:20px;">
        <button id="joinBtn" class="btn-main" style="background:#333; color:#fff;">JOIN ARENA</button>
    </div>

    <div id="gameScreen" class="hidden" style="display:flex; flex-direction:column; height: 100%;">
        <div style="padding:10px; display:flex; justify-content:space-between;">
            <button id="exitBtn" style="background:none; border:none; color:red; font-weight:bold;">EXIT</button>
            <div id="status" style="color:var(--primary);">WAITE...</div>
        </div>

        <div class="scoreboard">
            <div id="p1Box" style="padding:10px; border-radius:10px; text-align:center;">
                <div id="p1Name" style="font-size:12px;">P1</div>
                <div id="p1Score" style="font-size:24px;">0</div>
            </div>
            <div style="font-size:30px;">VS</div>
            <div id="p2Box" style="padding:10px; border-radius:10px; text-align:center;">
                <div id="p2Name" style="font-size:12px;">P2</div>
                <div id="p2Score" style="font-size:24px;">0</div>
            </div>
        </div>

        <div id="board"></div>

        <div id="emojiBar" style="display:flex; justify-content:center; gap:20px; font-size:30px; padding:10px;">
            <span class="e-btn">ðŸ˜‚</span><span class="e-btn">ðŸ”¥</span><span class="e-btn">ðŸ‘‘</span><span class="e-btn">âš¡</span>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// Firebase Config
const firebaseConfig = { apiKey: "AIzaSyARuO_pN2vdYrVKYkKHHaNys7WI8HqM6I4", databaseURL: "https://friendchat-43941-default-rtdb.firebaseio.com", projectId: "friendchat-43941" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// 10 Sound Effects
const sfx = {
    click: new Audio("https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"),
    moveX: new Audio("https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3"),
    moveO: new Audio("https://assets.mixkit.co/active_storage/sfx/2572/2572-preview.mp3"),
    win: new Audio("https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3"),
    draw: new Audio("https://assets.mixkit.co/active_storage/sfx/2574/2574-preview.mp3"),
    error: new Audio("https://assets.mixkit.co/active_storage/sfx/2573/2573-preview.mp3"),
    msg: new Audio("https://assets.mixkit.co/active_storage/sfx/2357/2357-preview.mp3"),
    emoji: new Audio("https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3"),
    start: new Audio("https://assets.mixkit.co/active_storage/sfx/2570/2570-preview.mp3"),
    btn: new Audio("https://assets.mixkit.co/active_storage/sfx/2567/2567-preview.mp3")
};

function play(n) { sfx[n].currentTime=0; sfx[n].play().catch(()=>{}); }

let myRoomId, myName, mySymbol, gameRef, gridSize = 3, isRobot = false;

// UI Handlers
document.getElementById('createBtn').onclick = () => {
    play('btn'); myName = document.getElementById('userName').value || "Player";
    myRoomId = Math.floor(1000 + Math.random()*8999).toString();
    startSetup("X");
};

document.getElementById('robotBtn').onclick = () => {
    play('btn'); isRobot = true; myName = "User"; myRoomId = "BOT_"+Date.now();
    startSetup("X");
};

document.getElementById('joinBtn').onclick = () => {
    play('btn'); myName = document.getElementById('userName').value || "Guest";
    myRoomId = document.getElementById('joinCode').value;
    if(myRoomId) startSetup("O");
};

function startSetup(sym) {
    mySymbol = sym;
    gameRef = db.ref("rooms/" + myRoomId + "/game");
    if(sym === "X") {
        gameRef.set({ board: Array(9).fill(""), turn: "X", size: 3, scores: {X:0, O:0}, players: {X: myName, O: isRobot ? "ROBOT" : "WAITING..."} });
    } else {
        gameRef.child("players/O").set(myName);
    }
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('gameScreen').classList.remove('hidden');
    play('start');
    initGame();
}

function initGame() {
    const bEl = document.getElementById('board');
    bEl.innerHTML = "";
    bEl.style.gridTemplateColumns = `repeat(3, 90px)`;
    
    for(let i=0; i<9; i++) {
        let c = document.createElement("div"); 
        c.className = "cell"; c.style.width = "90px"; c.style.height = "90px";
        c.onclick = () => {
            gameRef.once("value", snap => {
                let g = snap.val();
                if(g.turn !== mySymbol || g.board[i] !== "") { play('error'); return; }
                g.board[i] = mySymbol;
                gameRef.update({ board: g.board, turn: mySymbol === "X" ? "O" : "X" });
            });
        };
        bEl.appendChild(c);
    }

    gameRef.on("value", snap => {
        let g = snap.val(); if(!g) return;
        
        // Sync Scores & Turn
        document.getElementById('p1Score').innerText = g.scores.X;
        document.getElementById('p2Score').innerText = g.scores.O;
        document.getElementById('p1Box').className = g.turn === "X" ? "active-turn" : "";
        document.getElementById('p2Box').className = g.turn === "O" ? "active-turn" : "";

        // Update Board & Sounds
        g.board.forEach((v, i) => {
            let cell = bEl.children[i];
            if(cell.innerText !== v) {
                cell.innerHTML = `<span class="symbol-anim" style="color:${v==='X'?'#ff4d4d':'#ffd700'}; font-size:40px;">${v}</span>`;
                if(v === "X") play('moveX'); else if(v === "O") play('moveO');
            }
        });

        // Winner Check logic yahan simplified hai
        let win = checkWin(g.board);
        if(win) {
            if(win === "draw") { play('draw'); document.getElementById('winnerName').innerText="DRAW!"; }
            else { 
                play('win'); 
                document.getElementById('winnerName').innerText = (win === "X" ? g.players.X : g.players.O) + " WON!";
                if(win === mySymbol) confetti();
            }
            document.getElementById('winnerOverlay').style.display = "flex";
        }
    });
}

function checkWin(b) {
    const lines = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
    for(let l of lines) { if(b[l[0]] && b[l[0]]===b[l[1]] && b[l[0]]===b[l[2]]) return b[l[0]]; }
    return b.includes("") ? null : "draw";
}

document.getElementById('nextRoundBtn').onclick = () => {
    play('btn');
    gameRef.update({ board: Array(9).fill(""), turn: "X" });
    document.getElementById('winnerOverlay').style.display = "none";
};

document.querySelectorAll('.e-btn').forEach(e => {
    e.onclick = () => play('emoji');
});
</script>
</body>
    </html>
    
