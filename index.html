<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tic Tac Toe Online</title>

<style>
body{margin:0;font-family:system-ui;background:#000;color:#fff;text-align:center}
#login{padding:20px}
input,button{width:100%;padding:14px;margin:10px 0;border-radius:12px;border:none}
input{background:#111;color:#fff}
button{background:#1d9bf0;color:#fff;font-weight:bold}
#game{display:none;padding:20px}
#board{display:grid;grid-template-columns:repeat(3,90px);gap:10px;justify-content:center;margin:20px auto}
.cell{width:90px;height:90px;background:#1e1e1e;font-size:36px;display:flex;align-items:center;justify-content:center;border-radius:12px}
</style>
</head>

<body>

<div id="login">
  <h2>ðŸŽ® Tic Tac Toe</h2>
  <input id="name" placeholder="Your name">
  <input id="room" placeholder="Room code">
  <button id="join">Join</button>
</div>

<div id="game">
  <div id="status"></div>
  <div id="board"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getDatabase, ref, set, update, get, onValue }
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyARuO_pN2vdYrVKYkKHHaNys7WI8HqM6I4",
  authDomain: "friendchat-43941.firebaseapp.com",
  databaseURL: "https://friendchat-43941-default-rtdb.firebaseio.com",
  projectId: "friendchat-43941"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const login = document.getElementById("login");
const game = document.getElementById("game");
const statusDiv = document.getElementById("status");
const boardDiv = document.getElementById("board");

let roomId="", player="";
let board=["","","","","","","","",""];
let turn="X";

/* UI */
for(let i=0;i<9;i++){
  const d=document.createElement("div");
  d.className="cell";
  d.onclick=()=>move(i);
  boardDiv.appendChild(d);
}

/* JOIN (CORRECT METHOD) */
document.getElementById("join").onclick = async ()=>{
  roomId = room.value.trim();
  if(!roomId) return alert("Room likho");

  const roomRef = ref(db,"ttt/"+roomId);
  const snap = await get(roomRef);

  if(!snap.exists()){
    player="X";
    await set(roomRef,{
      board:["","","","","","","","",""],
      turn:"X",
      players:{X:true,O:false}
    });
  }else{
    const d=snap.val();
    if(!d.players.O){
      player="O";
      await update(roomRef,{
        "players/O":true
      });
    }else{
      alert("Room full");
      return;
    }
  }

  login.style.display="none";
  game.style.display="block";
  statusDiv.innerText="You are "+player;

  onValue(roomRef,s=>{
    const d=s.val();
    board=d.board;
    turn=d.turn;
    updateUI();
  });
};

/* MOVE */
function move(i){
  if(board[i] || turn!==player) return;
  board[i]=player;
  turn = player==="X"?"O":"X";
  update(ref(db,"ttt/"+roomId),{board,turn});
}

function updateUI(){
  document.querySelectorAll(".cell").forEach((c,i)=>c.innerText=board[i]);
  statusDiv.innerText = turn===player?"Your turn":"Opponent turn";
}
</script>

</body>
</html>
