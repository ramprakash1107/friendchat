<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>@rp_gupta_07 | Nuts Arena Pro Max</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, viewport-fit=cover">

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Syncopate:wght@400;700&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">

<style>
:root { 
    --p1: #00ff88; --p2: #ffcc00; --accent: #ff0055;
    --bg: #020205; --glass: rgba(255, 255, 255, 0.05);
    --neon: 0 0 15px var(--p1), 0 0 30px rgba(0,255,136,0.3);
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }

body, html { 
    margin: 0; padding: 0; height: 100%; width: 100%; 
    background: var(--bg); color: #fff; font-family: 'Rajdhani', sans-serif;
    overflow: hidden; position: fixed;
}

/* Heavy Background Animation */
.bg-vibe {
    position: fixed; inset: 0; z-index: -1;
    background: linear-gradient(45deg, #050505 25%, #0a0a0f 25%, #0a0a0f 50%, #050505 50%, #050505 75%, #0a0a0f 75%, #0a0a0f 100%);
    background-size: 40px 40px; animation: bgMove 4s linear infinite; opacity: 0.3;
}
@keyframes bgMove { from { background-position: 0 0; } to { background-position: 40px 40px; } }

.main-wrapper { 
    display: flex; flex-direction: column; height: 100%; max-width: 500px; 
    margin: auto; border-left: 1px solid rgba(255,255,255,0.05); border-right: 1px solid rgba(255,255,255,0.05);
    background: rgba(0,0,0,0.6); backdrop-filter: blur(25px);
}

/* Home Screen UI */
.screen { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px; }
.logo-container { position: relative; margin-bottom: 40px; animation: float 3s ease-in-out infinite; }
@keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }

.brand-text { font-family: 'Syncopate', sans-serif; font-size: 28px; font-weight: 700; text-align: center; line-height: 1.2; }
.brand-sub { color: var(--p1); font-size: 12px; letter-spacing: 4px; font-weight: 700; margin-top: 5px; text-shadow: var(--neon); }

/* Inputs */
.neon-input { 
    width: 100%; padding: 18px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.1);
    background: var(--glass); color: #fff; font-size: 16px; margin-bottom: 20px;
    text-align: center; transition: 0.3s; box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
}
.neon-input:focus { border-color: var(--p1); box-shadow: 0 0 20px rgba(0,255,136,0.2); }

/* Buttons */
.btn-pro { 
    width: 100%; padding: 18px; border-radius: 15px; border: none; font-weight: 700;
    font-family: 'Syncopate', sans-serif; font-size: 12px; cursor: pointer; margin-bottom: 12px;
    text-transform: uppercase; transition: 0.3s; position: relative; overflow: hidden;
}
.btn-pro::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: linear-gradient(transparent, rgba(255,255,255,0.1), transparent); transform: rotate(45deg); animation: shine 3s infinite; }
@keyframes shine { from { left: -150%; } to { left: 150%; } }

.p-green { background: linear-gradient(90deg, #00ff88, #00bd65); color: #000; box-shadow: 0 10px 25px rgba(0,255,136,0.3); }
.p-dark { background: #111; color: #fff; border: 1px solid #333; }

/* Game Board Design */
#board { display: grid; gap: 12px; margin: 25px auto; padding: 18px; background: rgba(255,255,255,0.02); border-radius: 25px; border: 1px solid rgba(255,255,255,0.05); }
.cell { 
    background: rgba(255,255,255,0.03); border-radius: 20px; display: flex; 
    align-items: center; justify-content: center; font-size: 40px; cursor: pointer;
    border: 1px solid rgba(255,255,255,0.05); transition: 0.2s cubic-bezier(0.1, 0.7, 1, 0.1);
}
.cell:active { transform: scale(0.85); background: rgba(0,255,136,0.1); }
.nut-x { color: var(--p1); text-shadow: 0 0 20px var(--p1); }
.nut-o { color: var(--p2); text-shadow: 0 0 20px var(--p2); }

.winner-cell { background: var(--p1) !important; color: #000 !important; box-shadow: 0 0 50px var(--p1); animation: winPulse 0.5s infinite alternate; }
@keyframes winPulse { from { opacity: 1; } to { opacity: 0.7; } }

/* Sidebar/Chat */
.chat-box { height: 180px; background: #000; display: flex; flex-direction: column; border-top: 1px solid #222; }
#msgs { flex: 1; overflow-y: auto; padding: 15px; font-size: 14px; }
.m-row { margin-bottom: 8px; display: flex; flex-direction: column; }
.m-me { align-items: flex-end; }
.m-txt { background: #222; padding: 8px 15px; border-radius: 12px; max-width: 80%; }
.m-me .m-txt { background: var(--p1); color: #000; font-weight: 700; }

.hidden { display: none !important; }
#winOverlay { position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 10000; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
</style>
</head>
<body>

<div class="bg-vibe"></div>

<div id="winOverlay">
    <div style="font-size:12px; letter-spacing:8px; color:#555; margin-bottom:10px;">DOMINATION COMPLETE</div>
    <h1 id="winName" style="font-size:70px; font-family:'Syncopate'; margin:0; text-shadow: 0 0 30px #fff;">WINNER</h1>
    <div style="width:100px; height:4px; background:var(--p1); margin:30px 0;"></div>
    <button onclick="restartGame()" class="btn-pro p-green" style="width:250px;">NEXT LEVEL</button>
</div>

<div class="main-wrapper">
    <div id="homeScreen" class="screen">
        <div class="logo-container">
            <div style="width:100px; height:100px; border:10px solid var(--p1); border-radius:50%; border-style:double; display:flex; align-items:center; justify-content:center; box-shadow:var(--neon);">
                <span style="font-size:50px;">â¬¢</span>
            </div>
        </div>
        
        <div class="brand-text">NUTS SORT<br>ARENA PRO</div>
        <div class="brand-sub">BY @RP_GUPTA_07</div>
        
        <div style="margin-top:40px; width:100%;">
            <input id="uName" class="neon-input" placeholder="PLAYER NICKNAME">
            
            <div style="display:flex; gap:10px; margin-bottom:20px;">
                <button class="grid-btn active" id="g3" onclick="setG(3)">3X3</button>
                <button class="grid-btn" id="g5" onclick="setG(5)">5X5</button>
                <button class="grid-btn" id="g7" onclick="setG(7)">7X7</button>
            </div>

            <button class="btn-pro p-green" onclick="createArena()">CREATE PRIVATE ARENA</button>
            <button class="btn-pro p-dark" onclick="startGlobal()">GLOBAL BATTLEFIELD</button>
            <button class="btn-pro p-dark" style="border-color:var(--accent); color:var(--accent);" onclick="startBot()">TRAINING VS ROBOT</button>

            <div style="display:flex; gap:10px; margin-top:10px;">
                <input id="roomIn" class="neon-input" placeholder="ARENA CODE" style="margin:0; flex:1;">
                <button class="btn-pro p-dark" style="width:100px; margin:0;" onclick="joinArena()">JOIN</button>
            </div>
        </div>
    </div>

    <div id="arenaScreen" class="hidden" style="display:flex; flex-direction:column; height:100%;">
        <div style="padding:20px; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #222;">
            <div onclick="location.reload()" style="font-weight:700; color:var(--accent); cursor:pointer;">QUIT</div>
            <div id="status" style="font-family:'Syncopate'; font-size:10px; color:var(--p1);">SYNCING...</div>
            <div id="roomIdShow" style="font-size:12px; opacity:0.3;">#0000</div>
        </div>

        <div style="flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center;">
            <div style="display:flex; justify-content:space-around; width:100%; margin-bottom:20px; background:var(--glass); padding:15px 0;">
                <div style="text-align:center;"><div id="p1N" style="font-size:10px;">P1</div><div id="p1S" style="font-size:25px; font-weight:900; color:var(--p1);">0</div></div>
                <div style="text-align:center;"><div id="p2N" style="font-size:10px;">P2</div><div id="p2S" style="font-size:25px; font-weight:900; color:var(--p2);">0</div></div>
            </div>

            <div id="board"></div>
            
            <div style="display:flex; gap:20px; padding:15px;">
                <span style="font-size:30px; cursor:pointer;" onclick="sendEmo('ðŸ”¥')">ðŸ”¥</span>
                <span style="font-size:30px; cursor:pointer;" onclick="sendEmo('ðŸ˜‚')">ðŸ˜‚</span>
                <span style="font-size:30px; cursor:pointer;" onclick="sendEmo('ðŸ‘‘')">ðŸ‘‘</span>
                <span style="font-size:30px; cursor:pointer;" onclick="sendEmo('ðŸ’€')">ðŸ’€</span>
            </div>
        </div>

        <div class="chat-box">
            <div id="msgs"></div>
            <div style="display:flex; padding:10px; gap:10px; background:#050505;">
                <input id="msgIn" placeholder="Type message..." style="margin:0; flex:1; background:#111; border:1px solid #333; color:#fff; padding:12px; border-radius:10px;">
                <button onclick="sendM()" style="background:var(--p1); border:none; width:60px; border-radius:10px; font-weight:900;">GO</button>
            </div>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyARuO_pN2vdYrVKYkKHHaNys7WI8HqM6I4",
  authDomain: "friendchat-43941.firebaseapp.com",
  databaseURL: "https://friendchat-43941-default-rtdb.firebaseio.com",
  projectId: "friendchat-43941",
  storageBucket: "friendchat-43941.firebasestorage.app",
  messagingSenderId: "1026542245723",
  appId: "1:1026542245723:web:b892bfcc1d2358a018ac7e"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let myId, myN, mySym, gRef, cRef, eRef, gSize = 3, isBot = false;

// Pro Sound Engine (Synthesized to save space)
const playSFX = (f, t) => {
    const a = new (window.AudioContext || window.webkitAudioContext)();
    const o = a.createOscillator(); const g = a.createGain();
    o.type = t; o.frequency.setValueAtTime(f, a.currentTime);
    g.gain.exponentialRampToValueAtTime(0.0001, a.currentTime + 0.5);
    o.connect(g); g.connect(a.destination); o.start(); o.stop(a.currentTime + 0.5);
};

function setG(s) {
    gSize = s; document.querySelectorAll('.grid-btn').forEach(b => b.classList.remove('active'));
    document.getElementById('g'+s).classList.add('active');
}

function startBot() {
    myN = document.getElementById("uName").value || "Player";
    isBot = true; myId = "BOT_" + Math.random().toString(36).substr(2,4);
    setupArena("X");
}

function startGlobal() {
    myN = document.getElementById("uName").value;
    if(!myN) return alert("Name please!");
    db.ref("matchmaking").once("value", s => {
        let w = s.val();
        if(w) { myId = w.r; db.ref("matchmaking").remove(); setupArena("O"); }
        else { myId = Math.floor(1000+Math.random()*8999).toString(); db.ref("matchmaking").set({r: myId}); setupArena("X"); }
    });
}

function createArena() {
    myN = document.getElementById("uName").value;
    if(!myN) return alert("Enter Name!");
    myId = Math.floor(1000+Math.random()*8999).toString();
    setupArena("X");
}

function joinArena() {
    myN = document.getElementById("uName").value;
    myId = document.getElementById("roomIn").value;
    if(!myN || !myId) return alert("Details missing!");
    setupArena("O");
}

function setupArena(s) {
    mySym = s;
    gRef = db.ref("rooms/"+myId+"/g");
    cRef = db.ref("rooms/"+myId+"/c");
    eRef = db.ref("rooms/"+myId+"/e");

    if(s === "X") {
        gRef.set({ b: Array(gSize*gSize).fill(""), t: "X", s: gSize, sc: {X:0, O:0}, p: {X: myN, O: isBot ? "ROBOT_AI" : "WAITING..."} });
    } else {
        gRef.child("p/O").set(myN);
    }

    document.getElementById("homeScreen").classList.add("hidden");
    document.getElementById("arenaScreen").classList.remove("hidden");
    document.getElementById("roomIdShow").innerText = "#"+myId;
    renderBoard(); listenArena(); listenChat(); listenEmos();
}

function renderBoard() {
    const b = document.getElementById("board");
    b.innerHTML = "";
    let cs = gSize === 3 ? 100 : gSize === 5 ? 65 : 45;
    b.style.gridTemplateColumns = `repeat(${gSize}, ${cs}px)`;
    for(let i=0; i<gSize*gSize; i++) {
        const div = document.createElement("div");
        div.className = "cell";
        div.style.width = cs+"px"; div.style.height = cs+"px";
        div.onclick = () => tap(i);
        b.appendChild(div);
    }
}

function listenArena() {
    gRef.on("value", s => {
        const data = s.val(); if(!data) return;
        document.getElementById("p1N").innerText = data.p.X;
        document.getElementById("p2N").innerText = data.p.O;
        document.getElementById("p1S").innerText = data.sc.X;
        document.getElementById("p2S").innerText = data.sc.O;

        data.b.forEach((v, i) => {
            const c = document.getElementById("board").children[i];
            if(v === "X") { c.innerText = "â¬¢"; c.className = "cell nut-x"; }
            else if(v === "O") { c.innerText = "â¬£"; c.className = "cell nut-o"; }
            else { c.innerText = ""; c.className = "cell"; }
        });

        const win = check(data.b, data.s);
        if(win) {
            if(win !== "draw") {
                playSFX(800, 'square');
                win.l.forEach(idx => document.getElementById("board").children[idx].classList.add("winner-cell"));
                setTimeout(() => {
                    document.getElementById("winName").innerText = (win.w === "X" ? data.p.X : data.p.O).toUpperCase();
                    document.getElementById("winOverlay").style.display = "flex";
                    if(win.w === mySym) confetti({particleCount:200});
                }, 800);
            } else {
                document.getElementById("winName").innerText = "TIE!";
                document.getElementById("winOverlay").style.display = "flex";
            }
        } else {
            document.getElementById("winOverlay").style.display = "none";
            document.getElementById("status").innerText = data.t === mySym ? "â˜… YOUR TURN â˜…" : "SYNCING ARENA...";
            if(isBot && data.t === "O") setTimeout(aiMove, 700);
        }
    });
}

function tap(i) {
    gRef.once("value", s => {
        const d = s.val();
        if(!d || d.t !== mySym || d.b[i] !== "" || check(d.b, d.s)) return;
        playSFX(400, 'sine');
        d.b[i] = mySym;
        let update = { b: d.b, t: mySym === "X" ? "O" : "X" };
        const w = check(d.b, d.s);
        if(w && w !== "draw") { d.sc[w.w]++; update.sc = d.sc; }
        gRef.update(update);
    });
}

function aiMove() {
    gRef.once("value", s => {
        const d = s.val(); if(!d || d.t !== "O") return;
        let b = [...d.b], sz = d.s, m = -1;
        // AI Logic
        for(let i=0; i<b.length; i++){ if(b[i]===""){ b[i]="O"; if(check(b,sz)){ m=i; break; } b[i]=""; } }
        if(m===-1){ for(let i=0; i<b.length; i++){ if(b[i]===""){ b[i]="X"; if(check(b,sz)){ m=i; break; } b[i]=""; } } }
        if(m===-1){ let e = b.map((v,i)=>v===""?i:null).filter(v=>v!==null); m=e[Math.floor(Math.random()*e.length)]; }
        if(m!==-1){ 
            d.b[m]="O"; let up = {b:d.b, t:"X"};
            const w = check(d.b, d.s); if(w && w !== "draw"){ d.sc.O++; up.sc = d.sc; }
            gRef.update(up);
        }
    });
}

function check(b, sz) {
    const l = []; let wl = 3;
    for(let i=0; i<sz; i++) {
        for(let j=0; j<=sz-wl; j++) {
            let r = []; for(let k=0; k<wl; k++) r.push(i*sz + j + k); l.push(r);
            let c = []; for(let k=0; k<wl; k++) c.push((j+k)*sz + i); l.push(c);
        }
    }
    for(let r=0; r<=sz-wl; r++) {
        for(let c=0; c<=sz-wl; c++) {
            let d1 = []; for(let k=0; k<wl; k++) d1.push((r+k)*sz + (c+k)); l.push(d1);
            let d2 = []; for(let k=0; k<wl; k++) d2.push((r+k)*sz + (c+wl-1-k)); l.push(d2);
        }
    }
    for(let win of l) { if(b[win[0]] && b[win[0]]===b[win[1]] && b[win[1]]===b[win[2]]) return {w: b[win[0]], l: win}; }
    return b.includes("") ? null : "draw";
}

function restartGame() { gRef.update({ b: Array(gSize*gSize).fill(""), t: "X" }); }
function sendM() { const i = document.getElementById("msgIn"); if(i.value) { cRef.push({ n: myN, m: i.value }); i.value = ""; } }
function listenChat() {
    cRef.on("child_added", s => {
        const d = s.val(); const div = document.createElement("div");
        div.className = "m-row " + (d.n === myN ? "m-me" : "");
        div.innerHTML = `<div class="m-txt"><small style="font-size:8px; display:block; opacity:0.5;">${d.n}</small>${d.m}</div>`;
        document.getElementById("msgs").appendChild(div);
        document.getElementById("msgs").scrollTop = 99999;
    });
}
function sendEmo(e) { eRef.set({ e: e, t: Date.now() }); }
function listenEmos() {
    eRef.on("value", s => {
        const d = s.val(); if(!d) return;
        const div = document.createElement("div");
        div.style = `position:fixed; bottom:200px; left:${20+Math.random()*60}%; font-size:60px; z-index:100;`;
        div.innerText = d.e; document.body.appendChild(div);
        div.animate([{transform:'translateY(0) scale(1)', opacity:1}, {transform:'translateY(-400px) scale(2)', opacity:0}], 1500);
        setTimeout(() => div.remove(), 1500);
    });
}
</script>
</body>
</html>

