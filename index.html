<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>RP_GUPTA_07 | NEON ARENA</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, viewport-fit=cover">

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">

<style>
:root { 
    --neon-cyan: #00f2ff; 
    --neon-pink: #ff007a;
    --dark-bg: #050505;
    --glass: rgba(255, 255, 255, 0.05);
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

body, html { 
    margin: 0; padding: 0; height: 100%; width: 100%; 
    background: var(--dark-bg); color: #fff; font-family: 'Rajdhani', sans-serif;
    overflow: hidden; position: fixed;
}

/* Cyber Grid Background */
.bg-grid {
    position: fixed; inset: 0; z-index: -1;
    background-image: linear-gradient(var(--glass) 1px, transparent 1px), linear-gradient(90deg, var(--glass) 1px, transparent 1px);
    background-size: 30px 30px;
    transform: perspective(500px) rotateX(60deg) translateY(-100px);
    animation: grid-move 5s linear infinite;
}
@keyframes grid-move { 0% { background-position: 0 0; } 100% { background-position: 0 30px; } }

.main-app { 
    display: flex; flex-direction: column; height: 100%; max-width: 450px; 
    margin: auto; border-left: 1px solid var(--glass); border-right: 1px solid var(--glass);
    background: rgba(5, 5, 5, 0.8); backdrop-filter: blur(10px);
}

.screen { flex: 1; display: flex; flex-direction: column; padding: 25px; align-items: center; justify-content: center; }

/* New Neon UI Components */
.neon-title { font-family: 'Orbitron', sans-serif; font-weight: 900; font-size: 32px; text-shadow: 0 0 15px var(--neon-cyan); margin-bottom: 5px; }
.admin-tag { font-size: 12px; color: var(--neon-cyan); letter-spacing: 3px; margin-bottom: 30px; opacity: 0.8; }

.input-box {
    width: 100%; background: var(--glass); border: 1px solid #333; padding: 15px;
    color: #fff; font-family: 'Orbitron'; font-size: 14px; margin-bottom: 15px; border-radius: 5px;
}

.btn-cyber {
    width: 100%; padding: 15px; border: none; font-family: 'Orbitron'; font-weight: 900;
    cursor: pointer; margin-bottom: 10px; border-radius: 5px; transition: 0.3s;
    text-transform: uppercase; letter-spacing: 2px;
}
.btn-primary { background: var(--neon-cyan); color: #000; box-shadow: 0 0 20px rgba(0,242,255,0.4); }
.btn-secondary { background: transparent; border: 1px solid var(--neon-pink); color: var(--neon-pink); }

/* Game Elements */
#board { display: grid; gap: 10px; margin: 20px auto; }
.cell { 
    background: var(--glass); border: 1px solid #222; border-radius: 8px;
    display: flex; align-items: center; justify-content: center; font-size: 40px; font-family: 'Orbitron';
}
.cell.X { color: var(--neon-cyan); text-shadow: 0 0 15px var(--neon-cyan); }
.cell.O { color: var(--neon-pink); text-shadow: 0 0 15px var(--neon-pink); }

/* Custom Victory Overlay */
#victoryLayer {
    position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 1000;
    display: none; flex-direction: column; align-items: center; justify-content: center;
}
.vic-text { font-family: 'Orbitron'; font-size: 40px; font-weight: 900; animation: blink 0.5s infinite; }

@keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

.hidden { display: none !important; }

/* Chat UI */
.chat-area { height: 180px; background: rgba(0,0,0,0.5); border-top: 1px solid #222; display: flex; flex-direction: column; }
#msgBox { flex: 1; overflow-y: auto; padding: 10px; font-size: 14px; }
.msg-line { margin-bottom: 5px; border-left: 2px solid var(--neon-cyan); padding-left: 8px; }
</style>
</head>
<body>

<div class="bg-grid"></div>

<div id="victoryLayer">
    <div class="vic-text" id="vicStatus">VICTORY</div>
    <div style="font-size: 18px; margin: 20px 0;" id="winnerDisp">PLAYER ONE</div>
    <button class="btn-cyber btn-primary" style="width: 200px;" onclick="resetMatch()">REMATCH</button>
</div>

<div class="main-app">
    <div id="home" class="screen">
        <div class="neon-title">ARENA 07</div>
        <div class="admin-tag">CREATED BY @RP_GUPTA_07</div>
        
        <input id="nick" class="input-box" placeholder="ENTER CALLSIGN...">
        
        <button class="btn-cyber btn-primary" onclick="initGame('X')">CREATE PRIVATE ROOM</button>
        <div style="display:flex; gap:10px; width:100%;">
            <input id="roomCode" class="input-box" placeholder="CODE" style="flex:1;">
            <button class="btn-cyber btn-secondary" style="width:100px;" onclick="joinGame()">JOIN</button>
        </div>
        <button class="btn-cyber btn-secondary" onclick="startAI()">PRACTICE VS AI</button>
    </div>

    <div id="arena" class="hidden" style="flex:1; display:flex; flex-direction:column;">
        <div style="padding:15px; display:flex; justify-content:space-between; border-bottom:1px solid #222;">
            <div onclick="exitGame()" style="color:var(--neon-pink); font-weight:900; cursor:pointer;">[ EXIT ]</div>
            <div id="matchID" style="opacity:0.5;">ID: ----</div>
        </div>

        <div style="display:flex; justify-content:space-around; padding:20px; background:var(--glass);">
            <div style="text-align:center;">
                <div id="name1" style="font-size:12px;">P1</div>
                <div id="score1" style="font-size:30px; font-family:'Orbitron'; color:var(--neon-cyan);">0</div>
            </div>
            <div style="align-self:center; font-family:'Orbitron'; opacity:0.3;">VS</div>
            <div style="text-align:center;">
                <div id="name2" style="font-size:12px;">P2</div>
                <div id="score2" style="font-size:30px; font-family:'Orbitron'; color:var(--neon-pink);">0</div>
            </div>
        </div>

        <div style="flex:1; display:flex; align-items:center; justify-content:center;">
            <div id="board"></div>
        </div>

        <div class="chat-area">
            <div id="msgBox"></div>
            <div style="display:flex; padding:10px; gap:5px;">
                <input id="mInp" placeholder="Type message..." style="flex:1; background:none; border:1px solid #333; color:#fff; padding:8px;">
                <button onclick="sendMsg()" style="background:var(--neon-cyan); border:none; padding:0 15px; font-weight:900;">></button>
            </div>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyARuO_pN2vdYrVKYkKHHaNys7WI8HqM6I4",
  authDomain: "friendchat-43941.firebaseapp.com",
  databaseURL: "https://friendchat-43941-default-rtdb.firebaseio.com",
  projectId: "friendchat-43941",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let roomID, mySym, isAI = false, userN;

function initGame(s) {
    userN = document.getElementById('nick').value || "PLAYER";
    roomID = Math.random().toString(36).substring(2, 8).toUpperCase();
    mySym = s;
    startSession();
}

function joinGame() {
    userN = document.getElementById('nick').value || "PLAYER";
    roomID = document.getElementById('roomCode').value.toUpperCase();
    if(!roomID) return;
    mySym = "O";
    startSession();
}

function startAI() {
    isAI = true;
    userN = document.getElementById('nick').value || "USER";
    roomID = "LOCAL_BOT";
    mySym = "X";
    startSession();
}

function startSession() {
    document.getElementById('home').classList.add('hidden');
    document.getElementById('arena').classList.remove('hidden');
    document.getElementById('matchID').innerText = "ROOM: " + roomID;

    const rRef = db.ref("arena/" + roomID);
    if(mySym === "X") {
        rRef.set({
            board: Array(9).fill(""),
            turn: "X",
            players: { X: userN, O: isAI ? "CYBER-BOT" : "WAITING..." },
            scores: { X: 0, O: 0 }
        });
    } else {
        rRef.child("players/O").set(userN);
    }

    syncGame();
    syncChat();
}

function syncGame() {
    const rRef = db.ref("arena/" + roomID);
    rRef.on("value", snap => {
        const data = snap.val();
        if(!data) return;

        document.getElementById('name1').innerText = data.players.X;
        document.getElementById('name2').innerText = data.players.O;
        document.getElementById('score1').innerText = data.scores.X;
        document.getElementById('score2').innerText = data.scores.O;

        renderGrid(data.board);

        const winner = checkWin(data.board);
        if(winner) {
            handleEnd(winner, data);
        } else {
            document.getElementById('victoryLayer').style.display = "none";
            if(isAI && data.turn === "O") setTimeout(() => botLogic(data), 600);
        }
    });
}

function renderGrid(board) {
    const container = document.getElementById('board');
    container.innerHTML = "";
    container.style.gridTemplateColumns = "repeat(3, 90px)";
    board.forEach((val, i) => {
        const div = document.createElement('div');
        div.className = `cell ${val}`;
        div.innerText = val;
        div.onclick = () => makeMove(i);
        container.appendChild(div);
    });
}

function makeMove(i) {
    const rRef = db.ref("arena/" + roomID);
    rRef.once("value", snap => {
        const d = snap.val();
        if(d.turn !== mySym || d.board[i] !== "" || checkWin(d.board)) return;
        
        d.board[i] = mySym;
        d.turn = (mySym === "X" ? "O" : "X");
        
        const win = checkWin(d.board);
        if(win && win !== "DRAW") d.scores[win]++;
        
        rRef.update(d);
    });
}

function checkWin(b) {
    const lines = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
    for(let l of lines) {
        if(b[l[0]] && b[l[0]]===b[l[1]] && b[l[1]]===b[l[2]]) return b[l[0]];
    }
    return b.includes("") ? null : "DRAW";
}

function handleEnd(w, d) {
    const layer = document.getElementById('victoryLayer');
    const status = document.getElementById('vicStatus');
    const winDisp = document.getElementById('winnerDisp');
    
    layer.style.display = "flex";
    if(w === "DRAW") {
        status.innerText = "DRAW";
        winDisp.innerText = "NO ONE SURVIVED";
    } else {
        status.innerText = "VICTORY";
        status.style.color = (w === "X" ? "var(--neon-cyan)" : "var(--neon-pink)");
        winDisp.innerText = (w === "X" ? d.players.X : d.players.O) + " DOMINATED!";
        if(w === mySym) confetti({particleCount: 200, spread: 70, origin: { y: 0.6 }});
    }
}

function resetMatch() {
    db.ref("arena/" + roomID).update({ board: Array(9).fill(""), turn: "X" });
}

// AUTO-NUKE FEATURE (Exit & Delete)
function exitGame() {
    if(confirm("Exit and Delete Match Data?")) {
        db.ref("arena/" + roomID).remove(); // Deletes everything
        db.ref("chats/" + roomID).remove(); // Deletes chats
        location.reload();
    }
}

// Chat System
function sendMsg() {
    const inp = document.getElementById('mInp');
    if(!inp.value) return;
    db.ref("chats/" + roomID).push({ n: userN, m: inp.value });
    inp.value = "";
}

function syncChat() {
    db.ref("chats/" + roomID).on("child_added", snap => {
        const d = snap.val();
        const div = document.createElement('div');
        div.className = "msg-line";
        div.innerHTML = `<strong>${d.n}:</strong> ${d.m}`;
        document.getElementById('msgBox').appendChild(div);
        document.getElementById('msgBox').scrollTop = 9999;
    });
}

// Simple Bot Logic
function botLogic(d) {
    let empty = d.board.map((v, i) => v === "" ? i : null).filter(v => v !== null);
    if(empty.length > 0) {
        let move = empty[Math.floor(Math.random()*empty.length)];
        d.board[move] = "O";
        d.turn = "X";
        const win = checkWin(d.board);
        if(win && win !== "DRAW") d.scores.O++;
        db.ref("arena/" + roomID).update(d);
    }
}
</script>
</body>
</html>
