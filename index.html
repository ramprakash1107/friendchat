<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Private DM Chat</title>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui;
  background:#000;
  color:#fff;
  height:100vh;
}

/* LOGIN */
#login{
  padding:20px;
}
#login h1{margin:0}
#login p{color:#aaa;font-size:14px}
#login input,#login button{
  width:100%;
  padding:14px;
  margin-top:12px;
  border:none;
  border-radius:12px;
  font-size:16px;
}
#login input{background:#111;color:#fff}
#login button{background:#1d9bf0;color:#fff;font-weight:bold}

/* APP */
#app{
  display:none;
  height:100%;
  display:flex;
}

/* USER LIST */
#users{
  width:35%;
  border-right:1px solid #222;
  overflow-y:auto;
}
.user{
  padding:14px;
  border-bottom:1px solid #111;
  cursor:pointer;
}
.user:hover{background:#111}

/* CHAT */
#chatArea{
  flex:1;
  display:flex;
  flex-direction:column;
}
header{
  padding:10px;
  border-bottom:1px solid #222;
}
#messages{
  flex:1;
  padding:10px;
  overflow-y:auto;
}
.msg{
  max-width:70%;
  padding:10px;
  margin:6px 0;
  border-radius:16px;
}
.me{
  background:#1d9bf0;
  align-self:flex-end;
}
.other{
  background:#1e1e1e;
  align-self:flex-start;
}
footer{
  display:flex;
  padding:8px;
  gap:8px;
}
footer input{
  flex:1;
  padding:12px;
  border:none;
  border-radius:20px;
  background:#111;
  color:#fff;
}
footer button{
  border:none;
  border-radius:50%;
  padding:0 16px;
  background:#1d9bf0;
  color:#fff;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login">
  <h1>üîê Private Chat</h1>
  <p>Online users select karke private chat karein</p>
  <input id="name" placeholder="Enter username">
  <button onclick="login()">Enter</button>
</div>

<!-- APP -->
<div id="app">
  <div id="users"></div>

  <div id="chatArea">
    <header id="chatHeader">Select a user</header>
    <div id="messages"></div>
    <footer>
      <input id="text" placeholder="Message...">
      <button onclick="send()">‚û§</button>
    </footer>
  </div>
</div>

<script type="module">
import { initializeApp } from
"https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import {
getDatabase, ref, set, push, onValue, remove
} from
"https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyARuO_pN2vdYrVKYkKHHaNys7WI8HqM6I4",
  authDomain: "friendchat-43941.firebaseapp.com",
  databaseURL: "https://friendchat-43941-default-rtdb.firebaseio.com",
  projectId: "friendchat-43941",
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let me="", currentUser="", chatId="";

window.login = ()=>{
  me = name.value.trim();
  if(!me) return alert("Name likho");
  set(ref(db,"online/"+me),true);
  login.style.display="none";
  app.style.display="flex";

  onValue(ref(db,"online"),s=>{
    users.innerHTML="";
    s.forEach(u=>{
      if(u.key!==me){
        const d=document.createElement("div");
        d.className="user";
        d.textContent=u.key;
        d.onclick=()=>openChat(u.key);
        users.appendChild(d);
      }
    });
  });
};

function openChat(user){
  currentUser=user;
  chatHeader.textContent=user;
  messages.innerHTML="";
  chatId=[me,user].sort().join("_");

  onValue(ref(db,"chats/"+chatId),s=>{
    messages.innerHTML="";
    s.forEach(m=>{
      const d=document.createElement("div");
      d.className="msg "+(m.val().from===me?"me":"other");
      d.textContent=m.val().text;
      messages.appendChild(d);
    });
    messages.scrollTop=messages.scrollHeight;
  });
}

window.send=()=>{
  if(!text.value||!currentUser)return;
  push(ref(db,"chats/"+chatId),{
    from:me,
    text:text.value
  });
  text.value="";
};

window.onbeforeunload=()=>{
  remove(ref(db,"online/"+me));
  remove(ref(db,"chats/"+chatId)); // chat delete on leave
};
</script>

</body>
</html>
