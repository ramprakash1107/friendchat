<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RP Gupta Ludo Pro</title>
    <style>
        :root { --red: #ff4757; --green: #2ed573; --blue: #1e90ff; --yellow: #ffa502; --bg: #1e1e2e; }
        body { background: var(--bg); color: white; font-family: sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; overflow: hidden; height: 100vh; }
        
        #status-bar { background: #2d2d44; width: 100%; padding: 12px; text-align: center; font-weight: bold; border-bottom: 2px solid #3d3d5c; color: #2ed573; }

        /* Ludo Board Container */
        .ludo-board { 
            position: relative; width: 95vw; height: 95vw; max-width: 400px; max-height: 400px; 
            background: #fff; display: grid; grid-template-columns: repeat(15, 1fr); 
            grid-template-rows: repeat(15, 1fr); border: 4px solid #333; margin-top: 20px;
        }

        /* Cells and Lines */
        .cell { border: 0.2px solid #ddd; box-sizing: border-box; display: flex; align-items: center; justify-content: center; position: relative; }
        
        /* Home Squares */
        .home { border: 2px solid #333; z-index: 5; display: flex; flex-wrap: wrap; align-items: center; justify-content: center; padding: 10px; }
        .red-home { grid-area: 1/1/7/7; background: var(--red); }
        .green-home { grid-area: 1/10/7/16; background: var(--green); }
        .blue-home { grid-area: 10/1/16/7; background: var(--blue); }
        .yellow-home { grid-area: 10/10/16/16; background: var(--yellow); }
        .center-finish { grid-area: 7/7/10/10; background: #eee; border: 2px solid #333; display: flex; align-items: center; justify-content: center; color: #333; font-weight: bold; font-size: 10px; }

        /* Path Styling */
        .path-red { background: #ffcccc; }
        .path-yellow { background: #fff4cc; }

        /* Goti (Token) - Size Fixed */
        .token { 
            width: 80%; height: 80%; border-radius: 50%; 
            border: 2px solid #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.4); 
            z-index: 100; transition: all 0.4s ease;
        }

        /* Controls */
        .controls { width: 100%; display: flex; justify-content: space-around; align-items: center; padding: 15px 0; background: #2d2d44; position: fixed; bottom: 0; border-top: 2px solid #3d3d5c; }
        .dice-box { width: 55px; height: 55px; background: white; border-radius: 10px; color: #333; display: flex; align-items: center; justify-content: center; font-size: 28px; font-weight: bold; box-shadow: 0 4px 0 #999; }
        button { padding: 12px 30px; border-radius: 50px; border: none; background: #2ed573; color: white; font-weight: bold; font-size: 16px; cursor: pointer; box-shadow: 0 4px 0 #1a7e43; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
    </style>
</head>
<body>

<div id="status-bar">Connecting...</div>

<div class="ludo-board" id="board-grid">
    <div class="home red-home" id="red-base"></div>
    <div class="home green-home"></div>
    <div class="home blue-home"></div>
    <div class="home yellow-home" id="yellow-base"></div>
    <div class="center-finish">FINISH</div>
</div>

<div class="controls">
    <div id="p-label" style="font-weight:bold;">Aap: ?</div>
    <div class="dice-box" id="dice-val">?</div>
    <button id="roll-btn" onclick="handleRoll()">ROLL</button>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
    import { getDatabase, ref, set, onValue, update } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyARuO_pN2vdYrVKYkKHHaNys7WI8HqM6I4",
        authDomain: "friendchat-43941.firebaseapp.com",
        databaseURL: "https://friendchat-43941-default-rtdb.firebaseio.com",
        projectId: "friendchat-43941",
        storageBucket: "friendchat-43941.appspot.com",
        messagingSenderId: "1026542245723",
        appId: "1:1026542245723:web:b892bfcc1d2358a018ac7e"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const gameRef = ref(db, 'ludo/real_match_1');

    // Create Path Cells
    const board = document.getElementById('board-grid');
    for(let i=0; i<225; i++) {
        let cell = document.createElement('div');
        cell.className = 'cell';
        board.appendChild(cell);
    }

    // Path Coordinates (Simulated for Red)
    const redPath = [[6,1],[6,2],[6,3],[6,4],[6,5],[5,6],[4,6],[3,6],[2,6],[1,6],[0,6],[0,7],[0,8],[1,8],[2,8],[3,8],[4,8],[5,8],[6,9],[6,10],[6,11],[6,12],[6,13],[6,14],[7,14],[8,14],[8,13],[8,12],[8,11],[8,10],[8,9],[9,8],[10,8],[11,8],[12,8],[13,8],[14,8],[14,7],[14,6],[13,6],[12,6],[11,6],[10,6],[9,5],[8,4],[8,3],[8,2],[8,1],[8,0],[7,0],[7,1],[7,2],[7,3],[7,4],[7,5],[7,6]];

    let myRole = "";
    let gameState = { turn: 'red', dice: 0, redPos: -1, yellowPos: -1 };

    window.handleRoll = () => {
        if(gameState.turn !== myRole) return;
        const roll = Math.floor(Math.random() * 6) + 1;
        let updateData = { dice: roll, turn: myRole === 'red' ? 'yellow' : 'red' };
        
        if(myRole === 'red') updateData.redPos = (gameState.redPos + roll) % 56;
        else updateData.yellowPos = (gameState.yellowPos + roll) % 56;
        
        update(gameRef, updateData);
    };

    onValue(gameRef, (snap) => {
        const data = snap.val();
        if(!data) return set(gameRef, gameState);
        gameState = data;

        document.getElementById('dice-val').innerText = data.dice;
        document.getElementById('status-bar').innerText = (data.turn === myRole) ? "AAPKI BAARI!" : "DOST KI BAARI...";
        renderGoti();
    });

    function renderGoti() {
        // Remove old tokens to refresh
        document.querySelectorAll('.token').forEach(t => t.remove());

        // Red Goti
        const rG = document.createElement('div');
        rG.className = 'token';
        rG.style.background = 'var(--red)';
        if(gameState.redPos === -1) document.getElementById('red-base').appendChild(rG);
        else moveGotiToPath(rG, redPath[gameState.redPos]);

        // Yellow Goti (Simplified for demo)
        const yG = document.createElement('div');
        yG.className = 'token';
        yG.style.background = 'var(--yellow)';
        if(gameState.yellowPos === -1) document.getElementById('yellow-base').appendChild(yG);
        else moveGotiToPath(yG, redPath[(gameState.yellowPos + 26) % 56]); // Offset for yellow
    }

    function moveGotiToPath(goti, coords) {
        const cellIndex = (coords[1] * 15) + coords[0];
        const targetCell = board.children[cellIndex + 5]; // Adjustment for home divs
        if(targetCell) targetCell.appendChild(goti);
    }

    window.onload = () => {
        myRole = confirm("Red (P1) loge?") ? 'red' : 'yellow';
        document.getElementById('p-label').innerText = "Aap: " + myRole.toUpperCase();
    };
</script>
</body>
</html>

