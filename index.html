<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Real Ludo Working</title>

<style>
body{
  margin:0;
  background:#111;
  color:#fff;
  font-family:sans-serif;
  text-align:center;
}
#board{
  width:300px;
  height:300px;
  margin:10px auto;
  display:grid;
  grid-template-columns:repeat(5,1fr);
  grid-template-rows:repeat(5,1fr);
  background:#fff;
  border:3px solid #000;
}
.cell{
  border:1px solid #999;
  position:relative;
}
.goti{
  width:22px;
  height:22px;
  border-radius:50%;
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
}
.red{background:#e53935}
.green{background:#43a047}

button{
  padding:10px 16px;
  border:none;
  border-radius:8px;
  background:#1d9bf0;
  color:#fff;
  font-size:16px;
}
#dice{font-size:26px;margin:8px}
</style>
</head>

<body>

<h3 id="roomText"></h3>
<h4 id="turnText"></h4>

<div id="board"></div>

<div id="dice">ðŸŽ² -</div>
<button onclick="rollDice()">ROLL</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getDatabase, ref, onValue, update, get, set } 
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

/* FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyARuO_pN2vdYrVKYkKHHaNys7WI8HqM6I4",
  databaseURL: "https://friendchat-43941-default-rtdb.firebaseio.com",
  projectId: "friendchat-43941",
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ROOM & COLOR */
const room = prompt("Room code");
const myColor = prompt("Color: red / green");

/* PATH (VISIBLE GRID PATH) */
const path = [0,1,2,3,4,9,14,19,24];

const gameRef = ref(db,"ludo/"+room);

/* INIT ONLY ONCE */
get(gameRef).then(snap=>{
  if(!snap.exists()){
    set(gameRef,{
      turn:"red",
      dice:0,
      red:{pos:-1},
      green:{pos:-1}
    });
  }
});

/* BOARD */
const board=document.getElementById("board");
for(let i=0;i<25;i++){
  const c=document.createElement("div");
  c.className="cell";
  c.id="c"+i;
  board.appendChild(c);
}

/* DRAW */
function draw(s){
  document.querySelectorAll(".cell").forEach(c=>c.innerHTML="");
  ["red","green"].forEach(col=>{
    const p=s[col].pos;
    if(p>=0){
      const g=document.createElement("div");
      g.className="goti "+col;
      document.getElementById("c"+path[p]).appendChild(g);
    }
  });
  document.getElementById("dice").textContent="ðŸŽ² "+s.dice;
  document.getElementById("turnText").textContent="Turn: "+s.turn;
}

/* LISTEN */
onValue(gameRef,snap=>{
  if(snap.exists()) draw(snap.val());
});

/* ROLL */
window.rollDice = ()=>{
  get(gameRef).then(snap=>{
    const s=snap.val();
    if(s.turn!==myColor){
      alert("Aapki turn nahi hai");
      return;
    }

    const d=Math.floor(Math.random()*6)+1;
    let me=s[myColor];
    const other=myColor==="red"?"green":"red";

    if(me.pos===-1){
      if(d===6) me.pos=0;
    }else if(me.pos+d < path.length){
      me.pos+=d;
    }

    if(me.pos>=0 && me.pos===s[other].pos){
      s[other].pos=-1; // CUT
    }

    update(gameRef,{
      dice:d,
      [myColor]:me,
      [other]:s[other],
      turn:other
    });
  });
};
</script>

</body>
</html>
