<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>RP_GUPTA_07 | HYPER ARENA</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@600&display=swap" rel="stylesheet">

    <style>
        :root { --neon: #00f2ff; --pink: #ff0055; --bg: #030305; --glass: rgba(255,255,255,0.03); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg); color: #fff; font-family: 'Rajdhani', sans-serif; overflow: hidden; height: 100vh; }

        /* Smooth Particle Background */
        .bg-fx { position: fixed; inset: 0; background: radial-gradient(circle at center, #111827 0%, #030305 100%); z-index: -1; }
        .bg-fx::before { content: ""; position: absolute; inset: 0; background-image: url('https://www.transparenttextures.com/patterns/stardust.png'); opacity: 0.2; }

        .layer { position: fixed; inset: 0; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 20px; z-index: 10; transition: 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        .active { display: flex; transform: scale(1); opacity: 1; }

        /* Profile - Zero Error Link */
        .p-circle { width: 110px; height: 110px; border-radius: 50%; border: 3px solid var(--neon); box-shadow: 0 0 30px rgba(0,242,255,0.5); margin-bottom: 15px; background: #111; overflow: hidden; }
        .p-circle img { width: 100%; height: 100%; object-fit: cover; }

        .btn-pro { padding: 18px 40px; border: none; border-radius: 12px; background: linear-gradient(135deg, var(--neon), #0066ff); color: #000; font-family: 'Orbitron'; font-size: 11px; font-weight: 900; cursor: pointer; margin: 10px; width: 280px; text-transform: uppercase; letter-spacing: 1px; transition: 0.3s; }
        .btn-pro:active { transform: translateY(4px); filter: brightness(1.2); }

        /* The Board - Clean & Sharp */
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; width: 100%; max-width: 330px; margin: 15px 0; }
        .box { aspect-ratio: 1/1; background: var(--glass); border: 1px solid rgba(255,255,255,0.1); border-radius: 18px; display: flex; align-items: center; justify-content: center; font-size: 45px; font-weight: bold; transition: 0.2s; backdrop-filter: blur(5px); }
        .box.x { color: var(--neon); text-shadow: 0 0 20px var(--neon); }
        .box.o { color: var(--pink); text-shadow: 0 0 20px var(--pink); }
        .win-glow { border-color: #ffcc00 !important; box-shadow: 0 0 30px #ffcc00; background: rgba(255,204,0,0.1); }

        /* Insta Chat - Premium Look */
        .insta-ui { width: 100%; max-width: 330px; height: 180px; background: rgba(0,0,0,0.8); border: 1px solid #222; border-radius: 20px; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 -10px 30px rgba(0,0,0,0.5); }
        #chat-flow { flex: 1; overflow-y: auto; padding: 12px; display: flex; flex-direction: column; gap: 8px; }
        .m { padding: 8px 14px; border-radius: 18px; font-size: 13px; max-width: 80%; line-height: 1.4; }
        .m.sent { align-self: flex-end; background: linear-gradient(45deg, #f09433, #dc2743, #bc1888); color: white; }
        .m.rec { align-self: flex-start; background: #262626; color: #fff; }

        input { background: #111; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 10px; margin-bottom: 10px; width: 280px; text-align: center; font-family: 'Rajdhani'; }
    </style>
</head>
<body onclick="secretTrigger()">

<div class="bg-fx"></div>

<div id="L1" class="layer active">
    <div class="p-circle">
        <img src="https://github.com/ramprakash1107.png" alt="RP_GUPTA_07">
    </div>
    <h1 style="font-family:'Orbitron'; font-size:18px; letter-spacing:3px;">RP_GUPTA_07</h1>
    <p style="color:var(--neon); font-size:12px; letter-spacing:5px; margin-bottom:30px;">ULTIMATE OWNER</p>
    
    <input type="text" id="nick" placeholder="ENTER YOUR NICKNAME">
    <input type="text" id="room" placeholder="ROOM CODE (E.G. 777)">
    
    <button class="btn-pro" onclick="startMulti()">START MULTIPLAYER</button>
    <p style="font-size:10px; color:#444; margin-top:20px;">v7.0 SECURE ENGINE</p>
</div>

<div id="L2" class="layer">
    <div style="display:flex; justify-content:space-between; width:100%; max-width:300px;">
        <span id="p1-tag" style="color:var(--neon)">PLAYER 1: 0</span>
        <span id="p2-tag" style="color:var(--pink)">PLAYER 2: 0</span>
    </div>
    
    <h2 id="turn-txt" style="font-size:14px; color:#888; margin:15px 0;">SYNCING BATTLE...</h2>
    
    <div class="grid" id="grid"></div>

    <div class="insta-ui">
        <div id="chat-flow"></div>
        <div style="display:flex; padding:10px; border-top:1px solid #222;">
            <input type="text" id="chat-in" placeholder="Message..." style="flex:1; margin:0; border:none; text-align:left; background:transparent;">
            <button onclick="sendMsg()" style="background:none; border:none; color:var(--neon); font-weight:bold; cursor:pointer;">SEND</button>
        </div>
    </div>
    <button class="btn-pro" onclick="location.reload()" style="background:red; width:100px; padding:10px; font-size:10px; margin-top:10px;">EXIT</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
    firebase.initializeApp({
        apiKey: "AIzaSyARuO_pN2vdYrVKYkKHHaNys7WI8HqM6I4",
        databaseURL: "https://friendchat-43941-default-rtdb.firebaseio.com"
    });
    const db = firebase.database();

    let myName, roomID, mySym, gameRef, chatRef;
    let board = Array(9).fill("");
    let taps = 0;

    function secretTrigger() {
        taps++; setTimeout(()=> taps=0, 800);
        if(taps === 3) { confetti(); alert("SYSTEM OVERRIDE: RP_GUPTA_07 ADMIN ACTIVE"); }
    }

    function startMulti() {
        myName = document.getElementById('nick').value || "Elite";
        roomID = document.getElementById('room').value || "1007";
        gameRef = db.ref("arena/" + roomID);
        chatRef = db.ref("chats/" + roomID);

        gameRef.once('value', s => {
            let d = s.val();
            if(!d) {
                mySym = "X";
                gameRef.set({ b: board, t: "X", p1: myName, p2: "", s1: 0, s2: 0 });
            } else {
                mySym = "O";
                gameRef.update({ p2: myName });
            }
            launchArena();
        });
    }

    function launchArena() {
        document.getElementById('L1').style.display = 'none';
        document.getElementById('L2').classList.add('active');
        initGrid();

        gameRef.on('value', s => {
            let data = s.val(); if(!data) return;
            board = data.b;
            refreshUI(data);
            checkWin(data.b);
        });

        chatRef.on('child_added', s => {
            let m = s.val();
            let flow = document.getElementById('chat-flow');
            let div = document.createElement('div');
            div.className = "m " + (m.u === myName ? "sent" : "rec");
            div.innerText = m.u + ": " + m.t;
            flow.appendChild(div);
            flow.scrollTop = flow.scrollHeight;
        });
    }

    function initGrid() {
        const g = document.getElementById('grid');
        g.innerHTML = '';
        for(let i=0; i<9; i++) {
            let d = document.createElement('div');
            d.className = 'box';
            d.onclick = () => move(i);
            g.appendChild(d);
        }
    }

    function move(i) {
        gameRef.once('value', s => {
            let d = s.val();
            if(d.b[i] !== "" || d.t !== mySym) return;
            if (window.navigator.vibrate) window.navigator.vibrate(40);
            d.b[i] = mySym;
            d.t = (mySym === "X") ? "O" : "X";
            gameRef.update(d);
        });
    }

    function refreshUI(d) {
        const boxes = document.getElementsByClassName('box');
        for(let i=0; i<9; i++) {
            boxes[i].innerText = d.b[i];
            boxes[i].className = 'box ' + (d.b[i] ? d.b[i].toLowerCase() : '');
        }
        document.getElementById('turn-txt').innerText = (d.t === mySym) ? "YOUR ATTACK" : "ENEMY THINKING...";
        document.getElementById('p1-tag').innerText = d.p1 + ": " + (d.s1 || 0);
        document.getElementById('p2-tag').innerText = (d.p2 || "WAITING") + ": " + (d.s2 || 0);
    }

    function sendMsg() {
        let t = document.getElementById('chat-in').value;
        if(!t) return;
        chatRef.push({ u: myName, t: t });
        document.getElementById('chat-in').value = '';
    }

    function checkWin(b) {
        const lines = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
        for(let l of lines) {
            if(b[l[0]] && b[l[0]] === b[l[1]] && b[l[0]] === b[l[2]]) {
                if(b[l[0]] === mySym) { confetti(); }
                setTimeout(() => {
                    gameRef.update({ b: Array(9).fill(""), t: "X" });
                }, 2000);
                return;
            }
        }
    }
</script>
</body>
</html>
