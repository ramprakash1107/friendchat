<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>RP_GUPTA_07 | NEON CLASH ONLINE</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, viewport-fit=cover">

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Orbitron:wght@900&display=swap" rel="stylesheet">

<style>
:root { --p1: #ff0055; --p2: #00f2ff; --gold: #ffb400; --bg: #050505; }
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
body, html { margin: 0; padding: 0; height: 100%; background: var(--bg); color: #fff; font-family: 'Orbitron', sans-serif; overflow: hidden; }

/* 3D Moving Wallpaper */
.bg-3d { position: fixed; inset: 0; z-index: -1; background: radial-gradient(circle, #1a1a1a, #000); }
.bg-grid { position: absolute; width: 200%; height: 200%; top: -50%; left: -50%; background-image: linear-gradient(rgba(0, 242, 255, 0.1) 2px, transparent 2px), linear-gradient(90deg, rgba(0, 242, 255, 0.1) 2px, transparent 2px); background-size: 60px 60px; transform: perspective(800px) rotateX(60deg); animation: moveGrid 10s linear infinite; }
@keyframes moveGrid { from { transform: translateY(0); } to { transform: translateY(60px); } }

.app { width: 100%; max-width: 450px; margin: auto; height: 100%; display: flex; flex-direction: column; background: rgba(0,0,0,0.8); backdrop-filter: blur(20px); border-inline: 1px solid #333; }

/* Home Page */
.home { padding: 30px; text-align: center; flex: 1; overflow-y: auto; }
.logo-3d { font-family: 'Black Ops One'; font-size: 50px; color: var(--gold); text-shadow: 0 10px 20px #000; transform: rotateX(15deg); margin: 30px 0; }
.btn-3d { width: 100%; padding: 20px; border: none; font-family: 'Orbitron'; font-weight: 900; border-radius: 12px; margin-bottom: 15px; cursor: pointer; background: linear-gradient(to bottom, var(--gold), #b37e00); box-shadow: 0 8px 0 #664800; transform: translateY(-4px); transition: 0.1s; }
.btn-3d:active { transform: translateY(0); box-shadow: 0 0 0 #000; }

/* Race Track UI */
.track { flex: 1; display: flex; flex-direction: column; justify-content: space-around; padding: 20px; perspective: 1000px; }
.lane { height: 60px; background: rgba(255,255,255,0.05); border: 2px solid #333; border-radius: 15px; position: relative; overflow: hidden; transform: rotateX(20deg); }
.finish-line { position: absolute; right: 0; top: 0; bottom: 0; width: 20px; background: repeating-linear-gradient(45deg, #000, #000 5px, #fff 5px, #fff 10px); }
.player-token { width: 40px; height: 40px; border-radius: 8px; position: absolute; top: 8px; left: 0; transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); box-shadow: 0 0 15px currentColor; }

/* Game Controls */
.dice-box { padding: 20px; text-align: center; border-top: 1px solid #333; }
#dice-val { font-size: 40px; font-weight: 900; color: var(--gold); margin-bottom: 10px; }

/* Chat */
.chat-sec { height: 150px; background: #000; border-top: 2px solid var(--gold); display: flex; flex-direction: column; }
#msgs { flex: 1; overflow-y: auto; padding: 10px; font-size: 13px; }

.hidden { display: none !important; }
</style>
</head>
<body>

<div class="bg-3d"><div class="bg-grid"></div></div>

<div class="app">
    <div id="home" class="home">
        <div class="logo-3d">NEON CLASH</div>
        <p style="color:var(--gold); font-size:12px; letter-spacing:3px;">ADMIN: @RP_GUPTA_07</p>

        <input id="uNick" style="width:100%; padding:18px; background:#111; border:2px solid #333; color:#fff; border-radius:10px; margin-bottom:15px;" placeholder="ENTER CALLSIGN">
        
        <button class="btn-3d" onclick="init('X', true)">CREATE RACE ROOM</button>
        <div style="display:flex; gap:10px;">
            <input id="rInp" style="flex:1; padding:18px; background:#111; border:2px solid #333; color:#fff; border-radius:10px;" placeholder="CODE">
            <button class="btn-3d" style="width:100px; background:var(--p2); box-shadow:0 8px 0 #008ba3;" onclick="init('O', false)">JOIN</button>
        </div>
        
        <div style="margin-top:30px; font-size:11px; opacity:0.6;">
            <b>HOW TO PLAY:</b> Roll the dice to move your block. Reach the finish line first to win!
        </div>
    </div>

    <div id="arena" class="hidden" style="flex:1; display:flex; flex-direction:column;">
        <div style="padding:15px; display:flex; justify-content:space-between; background:#111; border-bottom:1px solid var(--gold);">
            <div onclick="nuke()" style="color:var(--p1); font-weight:900; cursor:pointer;">[ EXIT ]</div>
            <div id="turnTag" style="color:var(--gold)">READY</div>
            <div id="roomTag" style="opacity:0.4;">#----</div>
        </div>

        <div class="track">
            <div class="lane">
                <div id="p1-token" class="player-token" style="background:var(--p1); color:var(--p1);"></div>
                <div class="finish-line"></div>
                <div style="position:absolute; left:10px; top:20px; font-size:10px;" id="p1-name">P1</div>
            </div>
            <div class="lane">
                <div id="p2-token" class="player-token" style="background:var(--p2); color:var(--p2);"></div>
                <div class="finish-line"></div>
                <div style="position:absolute; left:10px; top:20px; font-size:10px;" id="p2-name">P2</div>
            </div>
        </div>

        <div class="dice-box">
            <div id="dice-val">ðŸŽ²</div>
            <button id="rollBtn" class="btn-3d" style="width:200px; margin:0 auto;" onclick="roll()">ROLL DICE</button>
        </div>

        <div class="chat-sec">
            <div id="msgs"></div>
            <div style="display:flex; padding:8px; background:#111;">
                <input id="mIn" style="flex:1; background:none; border:none; color:#fff;" placeholder="Chat with friend...">
                <button onclick="send()" style="color:var(--gold); background:none; border:none; font-weight:900;">SEND</button>
            </div>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyARuO_pN2vdYrVKYkKHHaNys7WI8HqM6I4",
    authDomain: "friendchat-43941.firebaseapp.com",
    databaseURL: "https://friendchat-43941-default-rtdb.firebaseio.com",
    projectId: "friendchat-43941",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let rId, sym, nick;

function init(s, host) {
    nick = document.getElementById('uNick').value || "PLAYER";
    rId = host ? Math.random().toString(36).substr(2,6).toUpperCase() : document.getElementById('rInp').value.toUpperCase();
    sym = s;
    start();
}

function start() {
    document.getElementById('home').classList.add('hidden');
    document.getElementById('arena').classList.remove('hidden');
    document.getElementById('roomTag').innerText = "#" + rId;

    const ref = db.ref("clash_arena/"+rId);
    if(sym === "X") {
        ref.set({ pos1: 0, pos2: 0, t: "X", n1: nick, n2: "WAITING...", win: null });
    } else {
        ref.child("n2").set(nick);
    }
    sync();
}

function sync() {
    db.ref("clash_arena/"+rId).on("value", s => {
        const d = s.val(); if(!d) return;
        
        // Update Positions (Scale 0-90%)
        document.getElementById('p1-token').style.left = d.pos1 + "%";
        document.getElementById('p2-token').style.left = d.pos2 + "%";
        document.getElementById('p1-name').innerText = d.n1;
        document.getElementById('p2-name').innerText = d.n2;
        document.getElementById('turnTag').innerText = d.t === sym ? "YOUR TURN" : "FRIEND'S TURN";
        
        if(d.win) {
            confetti({particleCount: 300});
            alert(d.win + " WON THE RACE!");
            db.ref("clash_arena/"+rId).update({ pos1: 0, pos2: 0, win: null });
        }
    });

    db.ref("clash_chats/"+rId).on("child_added", s => {
        const m = s.val();
        const div = document.createElement('div');
        div.innerHTML = `<b style="color:var(--gold)">${m.n}:</b> ${m.m}`;
        document.getElementById('msgs').appendChild(div);
        document.getElementById('msgs').scrollTop = 999;
    });
}

function roll() {
    db.ref("clash_arena/"+rId).once("value", s => {
        const d = s.val();
        if(d.t !== sym || d.win) return;
        
        let move = Math.floor(Math.random() * 6) + 1;
        document.getElementById('dice-val').innerText = "ðŸŽ² " + move;
        
        if(sym === "X") {
            d.pos1 += (move * 5);
            if(d.pos1 >= 90) { d.pos1 = 90; d.win = d.n1; }
            d.t = "O";
        } else {
            d.pos2 += (move * 5);
            if(d.pos2 >= 90) { d.pos2 = 90; d.win = d.n2; }
            d.t = "X";
        }
        db.ref("clash_arena/"+rId).update(d);
    });
}

function nuke() {
    if(confirm("EXIT & DELETE MATCH?")) {
        db.ref("clash_arena/"+rId).remove();
        db.ref("clash_chats/"+rId).remove();
        location.reload();
    }
}

function send() {
    const i = document.getElementById('mIn');
    if(i.value) { db.ref("clash_chats/"+rId).push({ n: nick, m: i.value }); i.value = ""; }
}
</script>
</body>
</html>

