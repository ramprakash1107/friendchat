<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Online Real Ludo</title>

<style>
body{
  margin:0;
  background:#111;
  color:#fff;
  font-family:system-ui;
  text-align:center;
}
h2{margin:10px 0}

#login input,#login button{
  width:90%;
  padding:14px;
  margin:8px;
  border-radius:12px;
  border:none;
  font-size:16px;
}
button{
  background:#1d9bf0;
  color:#fff;
  font-weight:bold;
}
#game{display:none}

#board{
  width:300px;
  height:300px;
  margin:15px auto;
  display:grid;
  grid-template-columns:repeat(5,1fr);
  grid-template-rows:repeat(5,1fr);
  background:#fff;
}
.cell{
  border:1px solid #333;
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
}
.token{
  width:70%;
  height:70%;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  color:#fff;
  font-weight:bold;
  font-size:14px;
}
.red{background:#e53935}
.blue{background:#1e88e5}
.safe{background:#ddd}
</style>
</head>

<body>

<div id="login">
  <h2>ðŸŽ² Online Ludo</h2>
  <input id="room" placeholder="Room ID">
  <button onclick="createRoom()">Create Room</button>
  <button onclick="joinRoom()">Join Room</button>
</div>

<div id="game">
  <h3 id="turn">Turn:</h3>
  <div id="board"></div>
  <button onclick="rollDice()">ðŸŽ² Roll Dice</button>
  <h3 id="dice">-</h3>
</div>

<script type="module">
/* ================= FIREBASE ================= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getDatabase, ref, set, onValue, get } 
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyARuO_pN2vdYrVKYkKHHaNys7WI8HqM6I4",
  authDomain: "friendchat-43941.firebaseapp.com",
  databaseURL: "https://friendchat-43941-default-rtdb.firebaseio.com",
  projectId: "friendchat-43941",
  storageBucket: "friendchat-43941.firebasestorage.app",
  messagingSenderId: "1026542245723",
  appId: "1:1026542245723:web:b892bfcc1d2358a018ac7e"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ================= GAME ================= */

let roomId="", player="";
const PATH = [0,1,2,3,4,9,14,19,24,23,22,21,20,15,10,5];
const SAFE = [0,4,8,12];

const board=document.getElementById("board");
for(let i=0;i<25;i++){
  const d=document.createElement("div");
  d.className="cell";
  if(SAFE.includes(i)) d.classList.add("safe");
  board.appendChild(d);
}
const cells=[...document.querySelectorAll(".cell")];

function createRoom(){
  roomId=document.getElementById("room").value.trim();
  if(!roomId) return alert("Room ID likho");
  player="red";
  set(ref(db,"ludo/"+roomId),{
    turn:"red",
    dice:0,
    pos:{red:-1,blue:-1}
  });
  start();
}

function joinRoom(){
  roomId=document.getElementById("room").value.trim();
  if(!roomId) return alert("Room ID likho");
  player="blue";
  start();
}

function start(){
  document.getElementById("login").style.display="none";
  document.getElementById("game").style.display="block";

  onValue(ref(db,"ludo/"+roomId),snap=>{
    if(!snap.exists()) return;
    const d=snap.val();
    draw(d.pos);
    document.getElementById("turn").innerText="Turn: "+d.turn.toUpperCase();
    document.getElementById("dice").innerText=d.dice||"-";
  });
}

function rollDice(){
  get(ref(db,"ludo/"+roomId)).then(s=>{
    let g=s.val();
    if(g.turn!==player) return alert("Wait turn");
    if(g.dice!==0) return;

    g.dice=Math.floor(Math.random()*6)+1;

    if(g.pos[player]===-1){
      if(g.dice===6) g.pos[player]=0;
    }else{
      g.pos[player]+=g.dice;
      if(g.pos[player]>=PATH.length) g.pos[player]=PATH.length-1;

      // CUT
      if(!SAFE.includes(PATH[g.pos[player]])){
        let other=player==="red"?"blue":"red";
        if(g.pos[player]===g.pos[other]) g.pos[other]=-1;
      }
    }

    if(g.dice!==6){
      g.turn=player==="red"?"blue":"red";
      g.dice=0;
    }
    set(ref(db,"ludo/"+roomId),g);
  });
}

function draw(pos){
  document.querySelectorAll(".token").forEach(t=>t.remove());
  if(pos.red>=0){
    let t=document.createElement("div");
    t.className="token red";
    t.textContent="R";
    cells[PATH[pos.red]].appendChild(t);
  }
  if(pos.blue>=0){
    let t=document.createElement("div");
    t.className="token blue";
    t.textContent="B";
    cells[PATH[pos.blue]].appendChild(t);
  }
}
</script>
</body>
</html>
