<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>RP GUPTA | Pro Gamer Edition</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
<style>
:root { --primary: #00d2ff; --secondary: #3a7bd5; --bg: #080808; --cell: #121212; --win: #00ff88; --text: #ffffff; }
body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 0; display: flex; justify-content: center; }

.container { width: 100%; max-width: 420px; min-height: 100vh; display: flex; flex-direction: column; }

/* Fixed Header */
.header-fixed { position: sticky; top: 0; background: rgba(8, 8, 8, 0.9); backdrop-filter: blur(10px); z-index: 100; padding: 15px; border-bottom: 1px solid #222; text-align: center; }
.dev-brand { font-size: 14px; background: linear-gradient(to right, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 800; text-decoration: none; text-transform: uppercase; }

#scoreboard { display: flex; justify-content: space-between; align-items: center; background: #111; padding: 15px 25px; border-radius: 20px; margin-top: 10px; border: 1px solid #333; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
.score-item { text-align: center; }
.score-val { font-size: 28px; font-weight: 900; color: var(--primary); }
.player-name { font-size: 12px; color: #888; text-transform: uppercase; letter-spacing: 1px; }

/* Game Board */
#board { display: grid; grid-template-columns: repeat(3, 100px); gap: 12px; justify-content: center; margin: 25px auto; padding: 10px; }
.cell { width: 100px; height: 100px; background: var(--cell); border-radius: 18px; font-size: 55px; font-weight: 300; display: flex; align-items: center; justify-content: center; border: 1px solid #222; transition: all 0.2s ease; cursor: pointer; box-shadow: inset 0 0 10px rgba(255,255,255,0.02); }
.cell:active { transform: scale(0.95); }
.win-cell { border-color: var(--win); color: var(--win); background: rgba(0, 255, 136, 0.1); box-shadow: 0 0 20px rgba(0, 255, 136, 0.2); }

/* Modern Chat */
#chatSection { flex-grow: 1; padding: 10px 20px; display: flex; flex-direction: column; }
#messages { height: 160px; overflow-y: auto; display: flex; flex-direction: column; gap: 6px; margin-bottom: 10px; padding: 5px; }
.msg { max-width: 75%; padding: 10px 14px; border-radius: 20px; font-size: 14px; color: #fff; line-height: 1.4; }
.me { align-self: flex-end; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-bottom-right-radius: 4px; }
.other { align-self: flex-start; background: #222; border-bottom-left-radius: 4px; border: 1px solid #333; }

.input-area { display: flex; gap: 10px; background: #1a1a1a; padding: 10px 15px; border-radius: 30px; border: 1px solid #333; }
.input-area input { background: transparent; border: none; color: #fff; flex: 1; outline: none; font-size: 15px; }
.send-btn { background: var(--primary); border: none; color: #000; width: 35px; height: 35px; border-radius: 50%; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; }

/* Login */
#joinBox { padding: 80px 30px; text-align: center; }
.login-input { width: 100%; padding: 16px; border-radius: 15px; border: 1px solid #333; background: #111; color: #fff; font-size: 16px; margin-bottom: 20px; box-sizing: border-box; }
.start-btn { width: 100%; padding: 16px; border-radius: 15px; background: linear-gradient(to right, var(--primary), var(--secondary)); color: #000; font-weight: 800; border: none; font-size: 16px; letter-spacing: 1px; }

.hidden { display: none; }
#restartBtn { background: #fff; color: #000; padding: 10px 25px; border-radius: 25px; font-weight: bold; border: none; margin-bottom: 15px; cursor: pointer; }
</style>
</head>
<body>

<div class="container">
    <div id="joinBox">
        <h1 style="font-size: 35px; margin-bottom: 5px; letter-spacing: -1px;">RP GUPTA</h1>
        <p style="color: #555; margin-bottom: 40px;">THE ELITE GAMING ARENA</p>
        <input id="nameInput" class="login-input" placeholder="Your Name">
        <button onclick="joinRoom()" class="start-btn">ENTER ARENA</button>
        <br><br>
        <a href="https://www.instagram.com/rp_gupta_07" target="_blank" style="color:#e1306c; text-decoration:none; font-size:13px; font-weight:bold;">FOLLOW DEVELOPER @rp_gupta_07</a>
    </div>

    <div id="gameArea" class="hidden">
        <div class="header-fixed">
            <a href="https://www.instagram.com/rp_gupta_07" target="_blank" class="dev-brand">RP GUPTA OFFICIAL</a>
            <div id="scoreboard">
                <div class="score-item"><div class="player-name" id="p1Name">Player 1</div><div id="p1Score" class="score-val">0</div></div>
                <div style="font-weight: 900; opacity: 0.1; font-size: 20px;">VS</div>
                <div class="score-item"><div class="player-name" id="p2Name">Player 2</div><div id="p2Score" class="score-val">0</div></div>
            </div>
            <p id="status" style="margin: 12px 0 0 0; font-size: 13px; font-weight: bold; color: var(--primary); letter-spacing: 1px;"></p>
        </div>

        <div id="board"></div>
        
        <div style="text-align: center;">
            <button id="restartBtn" class="hidden" onclick="restart()">NEXT ROUND</button>
        </div>

        <div id="chatSection">
            <div id="messages"></div>
            <div class="input-area">
                <input id="chatInput" placeholder="Type a message...">
                <button onclick="sendMsg()" class="send-btn">âž¤</button>
            </div>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyARuO_pN2vdYrVKYkKHHaNys7WI8HqM6I4",
  authDomain: "friendchat-43941.firebaseapp.com",
  databaseURL: "https://friendchat-43941-default-rtdb.firebaseio.com",
  projectId: "friendchat-43941",
  storageBucket: "friendchat-43941.firebasestorage.app",
  messagingSenderId: "1026542245723",
  appId: "1:1026542245723:web:b892bfcc1d2358a018ac7e"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const ROOM_ID = "RP_ULTIMATE_ZONE"; 
let mySymbol, myName, gameRef, chatRef;

const boardDiv = document.getElementById("board");
for(let i=0; i<9; i++) {
    const d = document.createElement("div");
    d.className = "cell";
    d.onclick = () => move(i);
    boardDiv.appendChild(d);
}

function joinRoom() {
    myName = document.getElementById("nameInput").value.trim();
    if(!myName) return;

    gameRef = db.ref("rooms/" + ROOM_ID + "/game");
    chatRef = db.ref("rooms/" + ROOM_ID + "/chat");

    gameRef.once("value", snap => {
        let g = snap.val();
        if(!g || !g.players) {
            mySymbol = "X";
            gameRef.set({ board: Array(9).fill(""), turn: "X", lastStarter: "X", players: {X: myName}, scores: {X:0, O:0} });
        } else if(!g.players.O && g.players.X !== myName) {
            mySymbol = "O";
            g.players.O = myName;
            gameRef.update({ players: g.players });
        } else {
            mySymbol = g.players.X === myName ? "X" : "O";
        }
        document.getElementById("joinBox").classList.add("hidden");
        document.getElementById("gameArea").classList.remove("hidden");
        listenGame();
        listenChat();
    });
}

function listenGame() {
    gameRef.on("value", snap => {
        const g = snap.val();
        if(!g) return;
        g.board.forEach((v, i) => {
            boardDiv.children[i].innerText = v;
            boardDiv.children[i].classList.remove("win-cell");
            boardDiv.children[i].style.color = (v === 'X') ? 'var(--primary)' : '#ff4b2b';
        });
        document.getElementById("p1Name").innerText = g.players?.X || "Waiting...";
        document.getElementById("p2Name").innerText = g.players?.O || "Waiting...";
        document.getElementById("p1Score").innerText = g.scores?.X || 0;
        document.getElementById("p2Score").innerText = g.scores?.O || 0;

        const wData = checkWinner(g.board);
        if(wData) {
            document.getElementById("status").innerText = wData === "draw" ? "MATCH DRAW!" : (wData.w === "X" ? g.players.X : g.players.O) + " WON!";
            if(wData.line) wData.line.forEach(idx => boardDiv.children[idx].classList.add("win-cell"));
            document.getElementById("restartBtn").classList.remove("hidden");
        } else {
            document.getElementById("status").innerText = (g.turn === mySymbol) ? "YOUR MOVE" : "WAITING FOR OPPONENT...";
            document.getElementById("restartBtn").classList.add("hidden");
        }
    });
}

function move(i) {
    gameRef.once("value", snap => {
        const g = snap.val();
        if(!g || g.turn !== mySymbol || g.board[i] !== "" || checkWinner(g.board)) return;
        g.board[i] = mySymbol;
        g.turn = (mySymbol === "X") ? "O" : "X";
        if(checkWinner(g.board) && checkWinner(g.board) !== "draw") {
            if(!g.scores) g.scores = {X:0, O:0};
            g.scores[mySymbol]++;
        }
        gameRef.update(g);
    });
}

function restart() {
    gameRef.once("value", snap => {
        const g = snap.val();
        // Alternating Turn Logic: Jo pichli baar shuru kiya tha, uske ulta shuru hoga
        const nextStarter = (g.lastStarter === "X") ? "O" : "X";
        gameRef.update({ 
            board: Array(9).fill(""), 
            turn: nextStarter,
            lastStarter: nextStarter
        });
        chatRef.remove();
    });
}

function checkWinner(b) {
    const lines = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
    for(let l of lines) {
        if(b[l[0]] && b[l[0]] === b[l[1]] && b[l[1]] === b[l[2]]) return {w: b[l[0]], line: l};
    }
    return b.includes("") ? null : "draw";
}

function sendMsg() {
    const inp = document.getElementById("chatInput");
    if(!inp.value.trim()) return;
    chatRef.push({ name: myName, msg: inp.value });
    inp.value = "";
}

function listenChat() {
    const msgDiv = document.getElementById("messages");
    chatRef.on("child_added", snap => {
        const m = snap.val();
        const d = document.createElement("div");
        d.className = "msg " + (m.name === myName ? "me" : "other");
        d.innerHTML = m.msg;
        msgDiv.appendChild(d);
        msgDiv.scrollTop = msgDiv.scrollHeight;
    });
    chatRef.on("child_removed", () => msgDiv.innerHTML = "");
}
</script>
</body>
</html>
