<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>@RP_GUPTA_07 | 3D NEON ARENA</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Rajdhani:wght@700&display=swap" rel="stylesheet">

<style>
:root { 
    --neon: #ff0055; --cyan: #00f2ff; --gold: #ffb400;
    --bg: #030303; --glass: rgba(255,255,255,0.08);
}

body { 
    margin: 0; background: var(--bg); color: #fff; font-family: 'Rajdhani', sans-serif;
    overflow: hidden; height: 100vh; display: flex; flex-direction: column;
}

/* 1MB Feel Background */
.bg-fx {
    position: fixed; inset: 0; z-index: -1;
    background: radial-gradient(circle at 50% 50%, #1a1a1a 0%, #000 100%);
}
.bg-fx::after {
    content: ""; position: absolute; inset: 0;
    background: repeating-linear-gradient(0deg, transparent 0, rgba(0,255,255,0.05) 1px, transparent 2px);
    background-size: 100% 3px; pointer-events: none;
}

.container { width: 100%; max-width: 450px; margin: auto; height: 100%; border: 1px solid #333; background: rgba(0,0,0,0.9); }

/* Home UI - Bhara Hua Look */
.home-ui { padding: 20px; text-align: center; }
.header { font-family: 'Press Start 2P', cursive; font-size: 20px; color: var(--gold); text-shadow: 3px 3px 0 var(--neon); margin: 20px 0; }
.admin-badge { background: var(--neon); padding: 5px 15px; border-radius: 20px; font-size: 12px; margin-bottom: 20px; display: inline-block; }

.stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
.stat-card { background: var(--glass); padding: 10px; border: 1px solid #444; border-radius: 5px; }

.input-style { 
    width: 90%; padding: 15px; background: #111; border: 1px solid var(--cyan); 
    color: #fff; margin-bottom: 10px; font-weight: bold; text-transform: uppercase;
}

/* 3D BOARD LOGIC */
.board-3d-wrap { perspective: 1000px; margin: 20px auto; }
#board { 
    display: grid; grid-template-columns: repeat(3, 100px); gap: 15px;
    transform: rotateX(20deg); transform-style: preserve-3d;
}
.cell { 
    width: 100px; height: 100px; background: #151515; border: 2px solid #333;
    display: flex; align-items: center; justify-content: center;
    font-size: 50px; cursor: pointer; transition: 0.3s;
    box-shadow: 0 5px 0 #000; position: relative;
}
.cell:active { transform: translateZ(-10px); box-shadow: 0 0 0 #000; }
.cell.X { color: var(--neon); text-shadow: 0 0 20px var(--neon); }
.cell.O { color: var(--cyan); text-shadow: 0 0 20px var(--cyan); }

/* Victory Overlay */
#winScreen { 
    position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 100;
    display: none; flex-direction: column; align-items: center; justify-content: center;
}

.btn-main { 
    width: 90%; padding: 15px; border: none; font-weight: 900; cursor: pointer; 
    margin-top: 10px; clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%);
    background: var(--gold); color: #000; font-size: 16px;
}

/* Chat */
.chat-sec { height: 120px; background: #050505; display: flex; flex-direction: column; border-top: 2px solid var(--gold); }
#msgList { flex: 1; overflow-y: auto; padding: 10px; font-size: 12px; }

.hidden { display: none; }
</style>
</head>
<body>

<div class="bg-fx"></div>

<div id="winScreen">
    <h1 style="font-family:'Press Start 2P'; color:var(--gold);" id="winMsg">VICTORY!</h1>
    <h2 id="winnerName">----</h2>
    <button class="btn-main" onclick="rematch()">PLAY AGAIN</button>
</div>

<div class="container">
    <div id="homeScreen" class="home-ui">
        <div class="header">ELITE XO</div>
        <div class="admin-badge">ADMIN: @RP_GUPTA_07</div>
        
        <div class="stat-grid">
            <div class="stat-card">ONLINE<br><span style="color:var(--cyan)">1,402</span></div>
            <div class="stat-card">MATCHES<br><span style="color:var(--neon)">24,810</span></div>
        </div>

        <input id="uName" class="input-style" placeholder="ENTER NICKNAME">
        <button class="btn-main" onclick="start(true)">CREATE PRIVATE BATTLE</button>
        
        <div style="display:flex; width:90%; margin: 10px auto; gap:5px;">
            <input id="rCode" class="input-style" style="margin:0;" placeholder="ROOM CODE">
            <button onclick="start(false)" style="background:var(--cyan); border:none; padding:10px;">JOIN</button>
        </div>

        <button class="btn-main" style="background:transparent; color:#fff; border:1px solid #444;" onclick="startAI()">VS ROBOT AI</button>
        
        <p style="font-size:10px; color:#555; margin-top:30px;">V.2.0.6 - ENCRYPTED CONNECTION</p>
    </div>

    <div id="arenaScreen" class="hidden" style="height:100%; display:flex; flex-direction:column;">
        <div style="display:flex; justify-content:space-between; padding:15px; background:#111;">
            <div onclick="exitGame()" style="color:var(--neon); cursor:pointer; font-weight:bold;">[ EXIT ]</div>
            <div id="turnTag" style="color:var(--gold)">X TURN</div>
            <div id="roomIDShow">#----</div>
        </div>

        <div style="display:flex; justify-content:space-around; background:var(--glass); padding:10px;">
            <div><small>P1</small><div id="s1" style="font-size:24px; color:var(--neon)">0</div></div>
            <div style="font-size:24px; opacity:0.3;">VS</div>
            <div><small>P2</small><div id="s2" style="font-size:24px; color:var(--cyan)">0</div></div>
        </div>

        <div style="flex:1; display:flex; align-items:center; justify-content:center;">
            <div class="board-3d-wrap">
                <div id="board"></div>
            </div>
        </div>

        <div class="chat-sec">
            <div id="msgList"></div>
            <div style="display:flex; padding:5px;">
                <input id="chatIn" style="flex:1; background:#1a1a1a; border:none; color:#fff; padding:8px;" placeholder="Message...">
                <button onclick="sendMsg()" style="background:var(--gold); border:none; padding:0 15px;">></button>
            </div>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// Firebase Engine
const firebaseConfig = {
  apiKey: "AIzaSyARuO_pN2vdYrVKYkKHHaNys7WI8HqM6I4",
  authDomain: "friendchat-43941.firebaseapp.com",
  databaseURL: "https://friendchat-43941-default-rtdb.firebaseio.com",
  projectId: "friendchat-43941",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let myId, mySym, isBot = false, myN;

// 1MB Feel Sound System
function playSound(type) {
    const ctx = new AudioContext();
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.type = type === 'X' ? 'square' : 'triangle';
    osc.frequency.setValueAtTime(type === 'X' ? 150 : 300, ctx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.1);
    osc.connect(gain); gain.connect(ctx.destination);
    osc.start(); osc.stop(ctx.currentTime + 0.1);
}

function start(isHost) {
    myN = document.getElementById('uName').value || "PLAYER";
    myId = isHost ? Math.random().toString(36).substr(2,6).toUpperCase() : document.getElementById('rCode').value.toUpperCase();
    mySym = isHost ? "X" : "O";
    init();
}

function startAI() {
    myN = document.getElementById('uName').value || "PLAYER";
    myId = "BOT_" + Math.random().toString(10).substr(2,4);
    isBot = true; mySym = "X";
    init();
}

function init() {
    document.getElementById('homeScreen').classList.add('hidden');
    document.getElementById('arenaScreen').classList.remove('hidden');
    document.getElementById('roomIDShow').innerText = "#" + myId;
    
    const ref = db.ref("games/"+myId);
    if(mySym === "X") {
        ref.set({ b: Array(9).fill(""), t: "X", p1: myN, p2: isBot ? "ROBO-07" : "WAITING...", s1:0, s2:0 });
    } else {
        ref.child("p2").set(myN);
    }
    sync();
    syncChat();
}

function sync() {
    db.ref("games/"+myId).on("value", s => {
        const d = s.val(); if(!d) return;
        document.getElementById('s1').innerText = d.s1;
        document.getElementById('s2').innerText = d.s2;
        document.getElementById('turnTag').innerText = d.t + " TURN";
        
        const board = document.getElementById('board');
        board.innerHTML = "";
        d.b.forEach((v, i) => {
            const c = document.createElement('div');
            c.className = "cell " + v;
            c.innerText = v;
            c.onclick = () => tap(i);
            board.appendChild(c);
        });

        const win = check(d.b);
        if(win) {
            document.getElementById('winScreen').style.display = "flex";
            document.getElementById('winnerName').innerText = win === "DRAW" ? "MATCH DRAW" : (win === "X" ? d.p1 : d.p2);
            if(win === mySym) confetti({particleCount:150});
        } else {
            document.getElementById('winScreen').style.display = "none";
            if(isBot && d.t === "O") setTimeout(() => bot(d), 500);
        }
    });
}

function tap(i) {
    const ref = db.ref("games/"+myId);
    ref.once("value", s => {
        const d = s.val();
        if(d.t !== mySym || d.b[i] !== "" || check(d.b)) return;
        playSound(mySym);
        d.b[i] = mySym;
        d.t = (mySym === "X" ? "O" : "X");
        const w = check(d.b);
        if(w && w !== "DRAW") { if(w === "X") d.s1++; else d.s2++; }
        ref.update(d);
    });
}

function check(b) {
    const l = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
    for(let i of l) if(b[i[0]] && b[i[0]]===b[i[1]] && b[i[1]]===b[i[2]]) return b[i[0]];
    return b.includes("") ? null : "DRAW";
}

function bot(d) {
    let e = d.board; // Simple Logic
    let empty = d.b.map((v,i)=>v===""?i:null).filter(v=>v!==null);
    if(empty.length > 0) {
        let move = empty[Math.floor(Math.random()*empty.length)];
        d.b[move] = "O"; d.t = "X";
        const w = check(d.b); if(w === "O") d.s2++;
        db.ref("games/"+myId).update(d);
    }
}

function exitGame() {
    if(confirm("DELETE MATCH DATA & EXIT?")) {
        db.ref("games/"+myId).remove();
        db.ref("chats/"+myId).remove();
        location.reload();
    }
}

function rematch() { db.ref("games/"+myId).update({ b: Array(9).fill(""), t: "X" }); }

function sendMsg() {
    const i = document.getElementById('chatIn');
    if(i.value) { db.ref("chats/"+myId).push({ n: myN, m: i.value }); i.value = ""; }
}

function syncChat() {
    db.ref("chats/"+myId).on("child_added", s => {
        const d = s.val();
        const div = document.createElement('div');
        div.innerHTML = `<span style="color:var(--gold)">${d.n}:</span> ${d.m}`;
        document.getElementById('msgList').appendChild(div);
        document.getElementById('msgList').scrollTop = 9999;
    });
}
</script>
</body>
</html>

