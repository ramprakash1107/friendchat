<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tic Tac Toe Online</title>

<style>
body{
  margin:0;
  font-family:system-ui;
  background:#000;
  color:#fff;
  text-align:center;
}
input,button{
  width:80%;
  padding:15px;
  font-size:18px;
  border-radius:10px;
  border:none;
  margin:10px 0;
}
button{background:#1d9bf0;color:#fff}
#game{display:none}
.grid{
  display:grid;
  grid-template-columns:repeat(3,100px);
  gap:10px;
  justify-content:center;
}
.cell{
  width:100px;height:100px;
  background:#111;
  font-size:40px;
  display:flex;
  align-items:center;
  justify-content:center;
}
</style>
</head>

<body>

<div id="join">
  <h2>Join Room</h2>
  <input id="room" placeholder="Room ID (1111)">
  <button onclick="joinRoom()">Join</button>
  <p id="status"></p>
</div>

<div id="game">
  <h2 id="role"></h2>
  <div class="grid" id="grid"></div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyARuO_pN2vdYrVKYkKHHaNys7WI8HqM6I4",
  authDomain: "friendchat-43941.firebaseapp.com",
  databaseURL: "https://friendchat-43941-default-rtdb.firebaseio.com",
  projectId: "friendchat-43941"
});

const db = firebase.database();
let roomId, mySymbol;

function joinRoom(){
  roomId = room.value;
  if(!roomId) return;

  const ref = db.ref("rooms/"+roomId);

  ref.once("value", snap=>{
    if(!snap.exists()){
      mySymbol = "X";
      ref.set({
        players:1,
        board:["","","","","","","","",""],
        turn:"X"
      });
    }else{
      mySymbol = "O";
      ref.update({players:2});
    }

    startGame();
  });
}

function startGame(){
  join.style.display="none";
  game.style.display="block";
  role.innerText = "You are "+mySymbol;

  const grid = document.getElementById("grid");
  grid.innerHTML="";

  for(let i=0;i<9;i++){
    const c = document.createElement("div");
    c.className="cell";
    c.onclick=()=>move(i);
    grid.appendChild(c);
  }

  db.ref("rooms/"+roomId).on("value",snap=>{
    const d=snap.val();
    if(!d) return;
    document.querySelectorAll(".cell").forEach((c,i)=>{
      c.innerText=d.board[i];
    });
  });
}

function move(i){
  const ref=db.ref("rooms/"+roomId);
  ref.once("value",snap=>{
    const d=snap.val();
    if(d.board[i]=="" && d.turn==mySymbol){
      d.board[i]=mySymbol;
      d.turn=mySymbol=="X"?"O":"X";
      ref.update(d);
    }
  });
}
</script>

</body>
</html>
