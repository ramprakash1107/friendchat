<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RP Gupta Ludo Real</title>
    <style>
        :root { --red: #ff4757; --green: #2ed573; --blue: #1e90ff; --yellow: #ffa502; }
        body { background: #121212; color: white; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; overflow: hidden; }
        
        #status-bar { background: #222; width: 100%; padding: 10px; text-align: center; font-weight: bold; border-bottom: 2px solid #444; }
        
        /* Ludo Board Setup */
        .ludo-container { position: relative; width: 95vw; height: 95vw; max-width: 450px; max-height: 450px; margin-top: 10px; background: white; display: grid; grid-template-columns: repeat(15, 1fr); grid-template-rows: repeat(15, 1fr); border: 5px solid #333; }
        .cell { border: 0.5px solid #ccc; position: relative; }
        
        /* Coloring Zones */
        .home-red { grid-area: 1/1/7/7; background: var(--red); }
        .home-green { grid-area: 1/10/7/16; background: var(--green); }
        .home-blue { grid-area: 10/1/16/7; background: var(--blue); }
        .home-yellow { grid-area: 10/10/16/16; background: var(--yellow); }
        .center-main { grid-area: 7/7/10/10; background: #fff; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #000; font-size: 10px; border: 2px solid #000; }
        
        /* Safe Cells & Paths */
        .safe { background: #d1d1d1 !important; }
        .path-red { background: #ffcccc; }
        .path-yellow { background: #fff4cc; }

        /* Tokens (Goti) */
        .token { width: 80%; height: 80%; border-radius: 50%; position: absolute; top: 10%; left: 10%; border: 2px solid #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.5); z-index: 10; transition: all 0.3s ease; }
        .t-red { background: var(--red); }
        .t-yellow { background: var(--yellow); }

        /* Controls */
        .controls { margin-top: 15px; width: 100%; display: flex; justify-content: space-around; align-items: center; }
        .dice-box { width: 60px; height: 60px; background: white; border-radius: 10px; color: black; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; box-shadow: 0 4px 0 #999; }
        button { padding: 15px 30px; border-radius: 30px; border: none; background: var(--green); color: white; font-weight: bold; font-size: 16px; cursor: pointer; box-shadow: 0 4px 0 #1a7e43; }
        button:disabled { background: #555; box-shadow: none; transform: translateY(4px); }
    </style>
</head>
<body>

<div id="status-bar">Connecting to Game...</div>

<div class="ludo-container" id="board">
    <div class="home-red"></div>
    <div class="home-green"></div>
    <div class="home-blue"></div>
    <div class="home-yellow"></div>
    <div class="center-main">FINISH</div>
    
    <div id="red-token-1" class="token t-red" style="grid-column: 2; grid-row: 2;" onclick="moveToken('red', 1)"></div>
    <div id="yellow-token-1" class="token t-yellow" style="grid-column: 11; grid-row: 11;" onclick="moveToken('yellow', 1)"></div>
</div>

<div class="controls">
    <div id="current-player">Turn: Red</div>
    <div class="dice-box" id="dice-val">?</div>
    <button id="roll-btn" onclick="handleRoll()">Roll Dice</button>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
    import { getDatabase, ref, set, onValue, update } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyARuO_pN2vdYrVKYkKHHaNys7WI8HqM6I4",
        authDomain: "friendchat-43941.firebaseapp.com",
        databaseURL: "https://friendchat-43941-default-rtdb.firebaseio.com",
        projectId: "friendchat-43941",
        storageBucket: "friendchat-43941.appspot.com",
        messagingSenderId: "1026542245723",
        appId: "1:1026542245723:web:b892bfcc1d2358a018ac7e"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const gameId = "global_ludo_1"; // Aap isse badal sakte hain
    const gameRef = ref(db, 'ludo/' + gameId);

    let myRole = ""; // 'red' ya 'yellow'
    let gameState = { turn: 'red', dice: 0, redPos: 0, yellowPos: 0 };

    // Game Logic
    window.handleRoll = () => {
        if (gameState.turn !== myRole) return alert("Abhi aapki baari nahi hai!");
        const roll = Math.floor(Math.random() * 6) + 1;
        update(gameRef, { dice: roll, canMove: true });
    };

    window.moveToken = (color, id) => {
        if (gameState.turn === color && color === myRole && gameState.dice > 0) {
            let newPos = (color === 'red' ? gameState.redPos : gameState.yellowPos) + gameState.dice;
            if (newPos > 57) return alert("Zyada hai!");
            
            let updateData = { dice: 0, turn: color === 'red' ? 'yellow' : 'red' };
            if(color === 'red') updateData.redPos = newPos;
            else updateData.yellowPos = newPos;
            
            update(gameRef, updateData);
        }
    };

    // Sync from Firebase
    onValue(gameRef, (snap) => {
        const data = snap.val();
        if(!data) {
            set(gameRef, gameState); // Init game
            return;
        }
        gameState = data;
        document.getElementById('dice-val').innerText = data.dice;
        document.getElementById('current-player').innerText = "Turn: " + data.turn.toUpperCase();
        document.getElementById('status-bar').innerText = (data.turn === myRole) ? "AAPKI BAARI HAI!" : "DOST CHAL RAHA HAI...";
        
        // Simple Visual Update (Coordinate logic can be expanded)
        updateVisuals();
    });

    function updateVisuals() {
        // Red simple path logic (example)
        const rt = document.getElementById('red-token-1');
        if (gameState.redPos > 0) {
            rt.style.gridColumn = 7; rt.style.gridRow = 15 - (gameState.redPos % 6);
        }
    }

    // Role Selection
    setTimeout(() => {
        myRole = confirm("Red banoge? (Cancel for Yellow)") ? 'red' : 'yellow';
        document.getElementById('status-bar').innerText = "Aap " + myRole + " hain. Game shuru karein!";
    }, 1000);

</script>
</body>
</html>
